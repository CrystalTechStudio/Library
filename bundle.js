!function r(e,t,n){function o(a,s){if(!t[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=t[a]={exports:{}};e[a][0].call(u.exports,(function(t){return o(e[a][1][t]||t)}),u,u.exports,r,e,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,n){},{}],2:[function(e,t,n){
/*!
 * Cross-Browser Split 1.1.1
 * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 * Available under the MIT License
 * ECMAScript compliant, uniform cross-browser split method
 */
t.exports=function split(e){var t,n=String.prototype.split,i=/()??/.exec("")[1]===e;return t=function(t,a,s){if("[object RegExp]"!==Object.prototype.toString.call(a))return n.call(t,a,s);var l,c,u,d,E=[],_=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.extended?"x":"")+(a.sticky?"y":""),p=0;a=new RegExp(a.source,_+"g");for(t+="",i||(l=new RegExp("^"+a.source+"$(?!\\s)",_)),s=s===e?-1>>>0:s>>>0;(c=a.exec(t))&&!((u=c.index+c[0].length)>p&&(E.push(t.slice(p,c.index)),!i&&c.length>1&&c[0].replace(l,(function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(c[t]=e)})),c.length>1&&c.index<t.length&&Array.prototype.push.apply(E,c.slice(1)),d=c[0].length,p=u,E.length>=s));)a.lastIndex===c.index&&a.lastIndex++;return p===t.length?!d&&a.test("")||E.push(""):E.push(t.slice(p)),E.length>s?E.slice(0,s):E},t}()},{}],3:[function(e,t,n){var i=e("indexof");function isTruthy(e){return!!e}t.exports=function ClassList(e){var t=e.classList;if(t)return t;var n={add:add,remove:remove,contains:contains,toggle:function toggle(e){return contains(e)?(remove(e),!1):(add(e),!0)},toString:function $toString(){return e.className},length:0,item:function item(e){return getTokens()[e]||null}};return n;function add(e){var t=getTokens();i(t,e)>-1||(t.push(e),setTokens(t))}function remove(e){var t=getTokens(),n=i(t,e);-1!==n&&(t.splice(n,1),setTokens(t))}function contains(e){return i(getTokens(),e)>-1}function getTokens(){return function filter(e,t){for(var n=[],i=0;i<e.length;i++)t(e[i])&&n.push(e[i]);return n}(e.className.split(" "),isTruthy)}function setTokens(t){var i=t.length;e.className=t.join(" "),n.length=i;for(var a=0;a<t.length;a++)n[a]=t[a];delete t[i]}}},{indexof:5}],4:[function(e,t,n){var i=e("browser-split"),a=e("class-list"),s="undefined"==typeof window?e("html-element"):window,l=s.document,c=s.Text;function context(){var e=[];function h(){var t=[].slice.call(arguments),n=null;function item(t){var s;if(null==t);else if("string"==typeof t)n?n.appendChild(s=l.createTextNode(t)):function parseClass(e){var t=i(e,/([\.#]?[^\s#.]+)/);/^\.|#/.test(t[1])&&(n=l.createElement("div")),forEach(t,(function(e){var t=e.substring(1,e.length);e&&(n?"."===e[0]?a(n).add(t):"#"===e[0]&&n.setAttribute("id",t):n=l.createElement(e))}))}(t);else if("number"==typeof t||"boolean"==typeof t||t instanceof Date||t instanceof RegExp)n.appendChild(s=l.createTextNode(t.toString()));else if(isArray(t))forEach(t,item);else if(isNode(t))n.appendChild(s=t);else if(t instanceof c)n.appendChild(s=t);else if("object"==typeof t)for(var u in t)if("function"==typeof t[u])/^on\w+/.test(u)?function(t,i){n.addEventListener?(n.addEventListener(t.substring(2),i[t],!1),e.push((function(){n.removeEventListener(t.substring(2),i[t],!1)}))):(n.attachEvent(t,i[t]),e.push((function(){n.detachEvent(t,i[t])})))}(u,t):(n[u]=t[u](),e.push(t[u]((function(e){n[u]=e}))));else if("style"===u)if("string"==typeof t[u])n.style.cssText=t[u];else for(var d in t[u])!function(i,a){if("function"==typeof a)n.style.setProperty(i,a()),e.push(a((function(e){n.style.setProperty(i,e)})));else var s=t[u][i].match(/(.*)\W+!important\W*$/);s?n.style.setProperty(i,s[1],"important"):n.style.setProperty(i,t[u][i])}(d,t[u][d]);else if("attrs"===u)for(var E in t[u])n.setAttribute(E,t[u][E]);else"data-"===u.substr(0,5)?n.setAttribute(u,t[u]):n[u]=t[u];else if("function"==typeof t){E=t();n.appendChild(s=isNode(E)?E:l.createTextNode(E)),e.push(t((function(e){isNode(e)&&s.parentElement?(s.parentElement.replaceChild(e,s),s=e):s.textContent=e})))}return s}for(;t.length;)item(t.shift());return n}return h.cleanup=function(){for(var t=0;t<e.length;t++)e[t]();e.length=0},h}function isNode(e){return e&&e.nodeName&&e.nodeType}function forEach(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n)}function isArray(e){return"[object Array]"==Object.prototype.toString.call(e)}(t.exports=context()).context=context},{"browser-split":2,"class-list":3,"html-element":1}],5:[function(e,t,n){var i=[].indexOf;t.exports=function(e,t){if(i)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],6:[function(e,t,n){var i,a,s=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(i===setTimeout)return setTimeout(e,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){i=defaultSetTimout}try{a="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){a=defaultClearTimeout}}();var l,c=[],u=!1,d=-1;function cleanUpNextTick(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&drainQueue())}function drainQueue(){if(!u){var e=runTimeout(cleanUpNextTick);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function runClearTimeout(e){if(a===clearTimeout)return clearTimeout(e);if((a===defaultClearTimeout||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new Item(e,t)),1!==c.length||u||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=noop,s.addListener=noop,s.once=noop,s.off=noop,s.removeListener=noop,s.removeAllListeners=noop,s.emit=noop,s.prependListener=noop,s.prependOnceListener=noop,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],7:[function(e,t,n){(function(t,i){(function(){var a=e("process/browser.js").nextTick,s=Function.prototype.apply,l=Array.prototype.slice,c={},u=0;function Timeout(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new Timeout(s.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new Timeout(s.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function onTimeout(){e._onTimeout&&e._onTimeout()}),t))},n.setImmediate="function"==typeof t?t:function(e){var t=u++,i=!(arguments.length<2)&&l.call(arguments,1);return c[t]=!0,a((function onNextTick(){c[t]&&(i?e.apply(null,i):e.call(null),n.clearImmediate(t))})),t},n.clearImmediate="function"==typeof i?i:function(e){delete c[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":6,timers:7}],8:[function(e,t,n){"use strict";function appendChildren(e,t){null!=t&&!1!==t&&(Array.isArray(t)?t.forEach((t=>appendChildren(e,t))):e.append(t))}Object.defineProperty(n,"__esModule",{value:!0}),n.$e=void 0,n.$e=function $e(e,t,...n){const i=document.createElement(e);if(null!==t)for(const[e,n]of Object.entries(t))if(null!==n)if("style"===e)for(const[e,t]of Object.entries(n))i.style[e]=t;else Array.isArray(n)?i[e]=n.join(" "):i[e]=n;return appendChildren(i,n),i}},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebugLogger=void 0;const i=e("./constant/materialDarkColors"),a=e("./data/settings"),s=e("./util/stringHash");n.DebugLogger=class DebugLogger{constructor(e){this.prefix="%c"+e,this.css="background-color: #"+i.materialDarkColors[Math.abs((0,s.stringHash)(e))%i.materialDarkColors.length]+"; border-radius: 0.3em; padding: 0 0.3em; color: white"}log(...e){a.developerMode.getValue()&&console.info(this.prefix,this.css,...e)}warn(...e){console.warn(this.prefix,this.css,...e)}error(...e){console.error(this.prefix,this.css,...e)}}},{"./constant/materialDarkColors":12,"./data/settings":44,"./util/stringHash":71}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Event=void 0;n.Event=class Event{constructor(){this.listeners=null,this.onceListeners=null,this.isEmitting=!1,this.queue=[]}runWhenNotEmitting(e){this.isEmitting?this.queue.push(e):e()}on(e){return this.runWhenNotEmitting((()=>{null===this.listeners&&(this.listeners=new Set),this.listeners.add(e)})),e}onUntil(e,t){this.runWhenNotEmitting((()=>{this.on(e),t.once((()=>this.off(e)))}))}off(e){this.runWhenNotEmitting((()=>{null!==this.listeners&&this.listeners.delete(e),null!==this.onceListeners&&this.onceListeners.delete(e)}))}once(e){return this.runWhenNotEmitting((()=>{null===this.onceListeners&&(this.onceListeners=new Set),this.onceListeners.add(e)})),e}onceUntil(e,t){this.runWhenNotEmitting((()=>{this.once(e),t.once((()=>this.off(e)))}))}expect(e){return this.isEmitting?new Promise((t=>{this.queue.push((()=>{this.expect(e).then(t)}))})):new Promise(void 0===e?e=>this.once(e):t=>{const n=this.on((i=>{e(i)&&(this.off(n),t(i))}))})}emit(e){this.runWhenNotEmitting((()=>{this.isEmitting=!0,null!==this.listeners&&this.listeners.forEach((t=>t(e,t))),null!==this.onceListeners&&(this.onceListeners.forEach((t=>t(e,t))),this.onceListeners=new Set),this.isEmitting=!1,this.queue.forEach((e=>e())),this.queue.length=0}))}}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Menu=n.ItemHandle=n.ItemLocation=n.ItemDecoration=void 0;const i=e("./control/layoutControl"),a=e("./DebugLogger"),s=e("./hs"),l=e("./util/DOM");var c,u;function createSpan(e,...t){const n=document.createElement("span");return n.innerText=e,n.classList.add(...t),n}!function(e){e[e.SELECTABLE=0]="SELECTABLE",e[e.BACK=1]="BACK",e[e.ICON_FOLDER=2]="ICON_FOLDER",e[e.ICON_LINK=3]="ICON_LINK",e[e.ICON_EQUALIZER=4]="ICON_EQUALIZER",e[e.ICON_FILE=5]="ICON_FILE",e[e.ICON_GAME=6]="ICON_GAME",e[e.ICON_NOTIFICATION=7]="ICON_NOTIFICATION",e[e.ICON_LIST=8]="ICON_LIST",e[e.ICON_CALENDER=9]="ICON_CALENDER",e[e.ICON_HISTORY=10]="ICON_HISTORY",e[e.ICON_CLEAR=11]="ICON_CLEAR",e[e.ICON_PERSON=12]="ICON_PERSON",e[e.ICON_TAG=13]="ICON_TAG"}(c=n.ItemDecoration||(n.ItemDecoration={})),function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(u=n.ItemLocation||(n.ItemLocation={}));class ItemHandle{constructor(e,t,n){this.menu=e,this.$flexElement=t,this.$innerElement=n,this.$prependSpan=null,this.$appendSpan=null}setSelected(e){return this.$innerElement.classList.toggle("selected",e),this}onClick(e){return this.$innerElement.addEventListener("click",(()=>{e(this)})),this}setInnerText(e){return this.$innerElement.innerText=e,this}addClass(e){return this.$innerElement.classList.add(e),this}removeClass(e){return this.$innerElement.classList.remove(e),this}prepend(e,t){null===this.$prependSpan&&(this.$prependSpan=createSpan("","prepend"),this.$innerElement.prepend(this.$prependSpan));const n=createSpan(e,"item-side");return void 0!==t&&n.classList.add(t),this.$prependSpan.prepend(n),n}append(e,t){null===this.$appendSpan&&(this.$appendSpan=createSpan("","append"),this.$innerElement.appendChild(this.$appendSpan));const n=createSpan(e,"item-side");return void 0!==t&&n.classList.add(t),this.$appendSpan.appendChild(n),n}remove(){this.$flexElement.remove()}}n.ItemHandle=ItemHandle;n.Menu=class Menu{constructor(e,t=i.Layout.OFF){this.urlBase=e,this.layout=t,this.subMenus=new Map,this.debugLogger=new a.DebugLogger(`Menu (${e})`),this.container=(0,s.h)(".menu.hidden"),document.body.appendChild(this.container)}destroy(){this.container.classList.add("hidden"),setTimeout((()=>this.container.remove()),1e3)}hide(){this.container.classList.add("hidden")}show(){(0,i.setLayout)(this.layout),(0,l.forceReflow)(this.container),this.container.classList.remove("hidden")}addItem(e,t={}){let n;if(t.button&&void 0!==t.link?(n=document.createElement("a"),n.href=t.link,n.rel="noopener noreferrer",t.link.startsWith("#")||(n.target="_blank")):n=document.createElement("div"),n.innerText=e,t.hidden&&n.classList.add("display-none"),t.button)switch(n.classList.add("button"),t.decoration){case c.BACK:n.classList.add("back");break;case c.SELECTABLE:n.classList.add("selectable");break;case c.ICON_FOLDER:n.classList.add("icon","folder");break;case c.ICON_LINK:n.classList.add("icon","link");break;case c.ICON_EQUALIZER:n.classList.add("icon","equalizer");break;case c.ICON_FILE:n.classList.add("icon","file");break;case c.ICON_GAME:n.classList.add("icon","game");break;case c.ICON_NOTIFICATION:n.classList.add("icon","notification");break;case c.ICON_LIST:n.classList.add("icon","list");break;case c.ICON_CALENDER:n.classList.add("icon","calender");break;case c.ICON_HISTORY:n.classList.add("icon","history");break;case c.ICON_CLEAR:n.classList.add("icon","clear");break;case c.ICON_PERSON:n.classList.add("icon","person");break;case c.ICON_TAG:n.classList.add("icon","icon-tag")}const i=(0,s.h)(".flex");return i.appendChild(n),t.location===u.BEFORE?this.container.prepend(i):this.container.appendChild(i),new ItemHandle(this,i,n)}buildSubMenu(e,t,...n){return new SubMenuBuilder(this,e,(e=>new t(`${this.urlBase}/${e}`,...n)))}registerSubMenu(e,t,n){this.subMenus.has(t)&&this.debugLogger.error(`Duplicated url segment: ${t}.`),this.subMenus.set(t,{name:e,factory:n})}};class SubMenuBuilder{constructor(e,t,n){this.parentMenu=e,this.name=t,this.subMenuFactory=n,this.decoration=void 0,this.hidden=!1,this.urlSegment=t,this.displayName=t}setUrlSegment(e){return this.urlSegment=e,this}setDecoration(e){return this.decoration=e,this}setDisplayName(e){return this.displayName=e,this}setHidden(e=!0){return this.hidden=e,this}build(){return this.parentMenu.registerSubMenu(this.name,this.urlSegment,(()=>this.subMenuFactory(this.urlSegment))),this.parentMenu.addItem(this.displayName,{button:!0,link:`${this.parentMenu.urlBase}/${this.urlSegment}`,decoration:this.decoration,hidden:this.hidden})}}},{"./DebugLogger":9,"./control/layoutControl":27,"./hs":45,"./util/DOM":62}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.materialDarkColors=void 0,n.materialDarkColors=["b71c1c","880e4f","4a148c","311b92","1a237e","0d47a1","01579b","006064","004d40","1b5e20","33691e","827717","bf360c","3e2723","795548","5d4037","1976d2","303f9f","3f51b5","673ab7","9c27b0","c2185b","d32f2f","263238","455a64","616161","212121"]},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VISIT_COUNT_LOAD_MORE=n.VISIT_COUNT_FAILED=n.VISIT_COUNT_LOADING=n.VISIT_COUNT_DESC_2=n.VISIT_COUNT_DESC_1=n.VISIT_COUNT_DESC_0=n.VISIT_COUNT_TITLE=n.COMMENTS_SEND_EMAIL_INPUT_PREFIX=n.COMMENTS_SEND_DISPLAY_NAME_PREFIX=n.COMMENTS_SEND_HINT=n.COMMENTS_LOSE_EDITED_CANCEL=n.COMMENTS_LOSE_EDITED_CONFIRM=n.COMMENTS_LOSE_EDITED_TITLE=n.COMMENTS_SEND_CONFIRM=n.COMMENTS_SEND_TITLE=n.COMMENTS_DELETE_CONFIRMATION=n.COMMENTS_REPLY=n.COMMENTS_DELETE=n.COMMENTS_SEND_DISPLAY_NAME_EDIT=n.COMMENTS_SEND_DISPLAY_NAME_1=n.COMMENTS_SEND_DISPLAY_NAME_0=n.COMMENTS_DELETING=n.COMMENTS_SENDING=n.COMMENTS_MODIFIED_DATE=n.COMMENTS_SUBMIT_BY=n.COMMENTS_MENTION_REPLIED_OK=n.COMMENTS_MENTION_REPLIED_TITLE=n.COMMENTS_MENTION_NO_TOKEN_DESC=n.COMMENTS_MENTION_NO_TOKEN_TITLE=n.COMMENTS_MENTION_LOADED=n.COMMENTS_MENTION_SECTION=n.COMMENTS_RECENT_LOADED=n.COMMENTS_RECENT_SECTION=n.COMMENTS_FAILED=n.COMMENTS_LOADED=n.COMMENTS_SEND=n.COMMENTS_UNAVAILABLE=n.COMMENTS_LOADING=n.COMMENTS_SECTION=n.BROKEN_LINK_OK=n.BROKEN_LINK_DESC=n.BROKEN_LINK_TITLE=n.BUILD_FAILED_OK=n.BUILD_FAILED_DESC=n.BUILD_FAILED_TITLE=n.CHAPTER_FAILED=n.CHAPTER_LOADING=n.NEXT_CHAPTER=n.GO_TO_MENU=n.PREVIOUS_CHAPTER=void 0,n.WTCD_ERROR_INTERNAL_DESC=n.WTCD_ERROR_INTERNAL_TITLE=n.WTCD_ERROR_RUNTIME_DESC=n.WTCD_ERROR_RUNTIME_TITLE=n.WTCD_ERROR_COMPILE_DESC=n.WTCD_ERROR_COMPILE_TITLE=n.WTCD_GAME_NO_DESC=n.WTCD_GAME_QUICK_LOAD_CONFIRM_CANCEL=n.WTCD_GAME_QUICK_LOAD_CONFIRM_CONFIRM=n.WTCD_GAME_QUICK_LOAD_CONFIRM_DESC=n.WTCD_GAME_QUICK_LOAD_CONFIRM_TITLE=n.WTCD_GAME_QUICK_LOAD_NOT_EXIST=n.WTCD_GAME_QUICK_LOAD_OK=n.WTCD_GAME_QUICK_LOAD=n.WTCD_GAME_QUICK_SAVE_OK=n.WTCD_GAME_QUICK_SAVE=n.WTCD_GAME_LOAD_OK=n.WTCD_GAME_LOAD_QUICK=n.WTCD_GAME_LOAD_CANCEL=n.WTCD_GAME_LOAD_TITLE=n.WTCD_GAME_LOAD=n.WTCD_GAME_SAVE_OK=n.WTCD_GAME_SAVE_OVERWRITE_CANCEL=n.WTCD_GAME_SAVE_OVERWRITE_CONFIRM=n.WTCD_GAME_SAVE_OVERWRITE_TITLE=n.WTCD_GAME_SAVE_NEW=n.WTCD_GAME_SAVE_CANCEL=n.WTCD_GAME_SAVE_TITLE=n.WTCD_GAME_SAVE=n.WTCD_GAME_RESTART_OK=n.WTCD_GAME_RESTART_CANCEL=n.WTCD_GAME_RESTART_DECISION_ONLY=n.WTCD_GAME_RESTART_ALL=n.WTCD_GAME_RESTART_DECISION_ONLY_DESC=n.WTCD_GAME_RESTART_ALL_DESC=n.WTCD_GAME_RESTART_DESC=n.WTCD_GAME_RESTART_TITLE=n.WTCD_GAME_RESTART=n.CLICK_TO_UNBLOCK=n.NO_BLOCKED_USERS=n.VISIT_COUNT_TIMES=n.VISIT_COUNT_DISPLAYING=n.VISIT_COUNT_TIME_FRAME_YEAR=n.VISIT_COUNT_TIME_FRAME_MONTH=n.VISIT_COUNT_TIME_FRAME_WEEK=n.VISIT_COUNT_TIME_FRAME_DAY=n.VISIT_COUNT_TIME_FRAME_HOUR=n.VISIT_COUNT_TIME_FRAME_ALL=n.VISIT_COUNT_LOAD_MORE_FAILED=n.VISIT_COUNT_LOAD_MORE_LOADING=void 0,n.USER_UPDATE_PROFILE_SUCCESS=n.USER_UPDATE_PROFILE_LOADING=n.USER_UPDATE_PROFILE_DISPLAY_NAME_EMPTY=n.USER_UPDATE_PROFILE_EMAIL_INPUT_LABEL=n.USER_UPDATE_PROFILE_DISPLAY_NAME_INPUT_LABEL=n.USER_UPDATE_PROFILE_USER_NAME_INPUT_LABEL=n.USER_UPDATE_PROFILE_HINT_EMAIL_1=n.USER_UPDATE_PROFILE_HINT_EMAIL_GRAVATAR_LINK=n.USER_UPDATE_PROFILE_HINT_EMAIL_0=n.USER_UPDATE_PROFILE_HINT_DISPLAY_NAME=n.USER_UPDATE_PROFILE_HINT_USER_NAME=n.USER_UPDATE_PROFILE_DESC=n.USER_UPDATE_PROFILE_TITLE=n.USER_UPDATE_PROFILE_ERROR_NOT_INITIALIZED=n.USER_TOKEN_DOES_NOT_EXIST=n.USER_TOKEN_CHANGE_INPUT_LABEL=n.USER_TOKEN_CHANGE_DESC=n.USER_TOKEN_CHANGE_TITLE=n.USER_TOKEN_CHANGE_SUCCESS=n.USER_TOKEN_CHANGE_CHECKING=n.USER_TOKEN_CHANGE_INVALID=n.USER_TOKEN_CHANGE_EMPTY=n.BACKEND_ERROR_UNKNOWN=n.BACKEND_ERROR_NAME_INVALID=n.BACKEND_ERROR_COMMENT_TOO_SHORT=n.BACKEND_ERROR_NAME_TOO_SHORT=n.BACKEND_ERROR_TOKEN_INVALID=n.BACKEND_ERROR_COMMENT_TOO_LONG=n.BACKEND_ERROR_EMAIL_INVALID=n.BACKEND_ERROR_EMAIL_TOO_LONG=n.BACKEND_ERROR_NAME_TOO_LONG=n.BACKEND_ERROR_EMAIL_DUPLICATED=n.BACKEND_ERROR_NAME_DUPLICATED=n.GENERIC_INTERNET_ERROR=n.GENERIC_CLOSE=n.GENERIC_CANCEL=n.GENERIC_CONFIRM=n.GENERIC_HINT_TITLE=n.GENERIC_LOADING_DESC=n.GENERIC_LOADING_TITLE=n.GENERIC_ERROR_DESC=n.GENERIC_ERROR_TITLE=n.GENERIC_SUCCESS_DESC=n.GENERIC_SUCCESS_TITLE=n.WTCD_CANVAS_LOADING=n.WTCD_ERROR_INTERNAL_STACK_DESC=n.WTCD_ERROR_INTERNAL_STACK_TITLE=n.WTCD_ERROR_WTCD_STACK_DESC=n.WTCD_ERROR_WTCD_STACK_TITLE=n.WTCD_ERROR_MESSAGE=void 0,n.MIRROR_LANDING_CONFLICT_KEEP=n.MIRROR_LANDING_CONFLICT_OVERWRITE=n.MIRROR_LANDING_CONFLICT_DESC=n.MIRROR_LANDING_CONFLICT_TITLE=n.MIRROR_LANDING_SUCCESS_HINT=n.MIRROR_LANDING_INVALID_REFERRAL=n.MIRROR_TECHNOLOGY=n.MIRROR_PROVIDED_BY=n.MIRROR_URL=n.MIRROR_DESC_1=n.MIRROR_DESC_0=n.MIRROR_DESC_0_NO_TOKEN=n.MIRROR_TITLE=n.AUTHOR_PAGE_LINK=n.AUTHOR_PAGE_AS=n.AUTHOR_PAGE_WORKS_DESC=n.AUTHOR_PAGE_WORKS=void 0,n.PREVIOUS_CHAPTER="上一章",n.GO_TO_MENU="返回",n.NEXT_CHAPTER="下一章",n.CHAPTER_LOADING="章节加载中...",n.CHAPTER_FAILED="章节加载失败，请检查网络连接。",n.BUILD_FAILED_TITLE="构建失败",n.BUILD_FAILED_DESC="晶体图书馆的网页构建脚本在构建过程中发生了可以恢复的异常。详细内容请参见控制台输出。",n.BUILD_FAILED_OK="我知道了",n.BROKEN_LINK_TITLE="损坏的链接",n.BROKEN_LINK_DESC="对不起，您提供的地址无法被正确解析，所以您现在回到了晶体图书馆的首页。",n.BROKEN_LINK_OK="我知道了",n.COMMENTS_SECTION="评论区",n.COMMENTS_LOADING="评论加载中...",n.COMMENTS_UNAVAILABLE="本文评论不可用。",n.COMMENTS_SEND="+ 发表评论",n.COMMENTS_LOADED="以下为本章节的评论区。",n.COMMENTS_FAILED="评论加载失败，请检查网络连接。",n.COMMENTS_RECENT_SECTION="最新评论",n.COMMENTS_RECENT_LOADED="以下是最新的五十条评论。",n.COMMENTS_MENTION_SECTION="最新回复",n.COMMENTS_MENTION_LOADED="以下是最新回复了您的评论。",n.COMMENTS_MENTION_NO_TOKEN_TITLE="最新回复不可用",n.COMMENTS_MENTION_NO_TOKEN_DESC="请至少发送了一条评论后再来查看。",n.COMMENTS_MENTION_REPLIED_TITLE="回复成功",n.COMMENTS_MENTION_REPLIED_OK="完成",n.COMMENTS_SUBMIT_BY="由$发表于 ",n.COMMENTS_MODIFIED_DATE="（最后修改于$）",n.COMMENTS_SENDING="正在发表评论...",n.COMMENTS_DELETING="正在删除评论...",n.COMMENTS_SEND_DISPLAY_NAME_0="将以",n.COMMENTS_SEND_DISPLAY_NAME_1="的身份发表评论。",n.COMMENTS_SEND_DISPLAY_NAME_EDIT="点此修改",n.COMMENTS_DELETE="删除评论",n.COMMENTS_REPLY="回复",n.COMMENTS_DELETE_CONFIRMATION="确定要删除这条评论吗？",n.COMMENTS_SEND_TITLE="发表评论",n.COMMENTS_SEND_CONFIRM="发表",n.COMMENTS_LOSE_EDITED_TITLE="是否放弃编写的内容？",n.COMMENTS_LOSE_EDITED_CONFIRM="放弃编写的内容",n.COMMENTS_LOSE_EDITED_CANCEL="继续编辑",n.COMMENTS_SEND_HINT="请填写评论内容。",n.COMMENTS_SEND_DISPLAY_NAME_PREFIX="昵称（必填）：",n.COMMENTS_SEND_EMAIL_INPUT_PREFIX="邮箱（可选）：",n.VISIT_COUNT_TITLE="访问量统计",n.VISIT_COUNT_DESC_0="访问量统计信息由晶体图书馆访问统计系统提供。晶体图书馆访问统计系统是专门为本小说编写的高度重视隐私保护的，不记录任何个人信息的数据统计服务。其隐私政策可以在",n.VISIT_COUNT_DESC_1="这里",n.VISIT_COUNT_DESC_2="找到。",n.VISIT_COUNT_LOADING="访问量加载中...",n.VISIT_COUNT_FAILED="访问量加载失败，请检查网络连接。",n.VISIT_COUNT_LOAD_MORE="加载更多",n.VISIT_COUNT_LOAD_MORE_LOADING="加载中...",n.VISIT_COUNT_LOAD_MORE_FAILED="加载失败，点此重试",n.VISIT_COUNT_TIME_FRAME_ALL="所有",n.VISIT_COUNT_TIME_FRAME_HOUR="1 小时内",n.VISIT_COUNT_TIME_FRAME_DAY="24 小时内",n.VISIT_COUNT_TIME_FRAME_WEEK="7 天内",n.VISIT_COUNT_TIME_FRAME_MONTH="30 天内",n.VISIT_COUNT_TIME_FRAME_YEAR="365 天内",n.VISIT_COUNT_DISPLAYING="正在显示$的访问量：",n.VISIT_COUNT_TIMES=" 次",n.NO_BLOCKED_USERS="没有用户的评论被屏蔽",n.CLICK_TO_UNBLOCK="(点击用户名以解除屏蔽)",n.WTCD_GAME_RESTART="重置游戏",n.WTCD_GAME_RESTART_TITLE="是否重置游戏种子",n.WTCD_GAME_RESTART_DESC="游戏种子会决定游戏的随机因素。",n.WTCD_GAME_RESTART_ALL_DESC="若选择【重置游戏种子与进度】，那么新游戏中的所有随机因素和本游戏不一致。",n.WTCD_GAME_RESTART_DECISION_ONLY_DESC="若选择【仅重置进度】，那么新游戏中的随机因素将与本游戏完全一致。",n.WTCD_GAME_RESTART_ALL="重置游戏种子与进度",n.WTCD_GAME_RESTART_DECISION_ONLY="仅重置进度",n.WTCD_GAME_RESTART_CANCEL="不重置任何内容",n.WTCD_GAME_RESTART_OK="游戏重置成功",n.WTCD_GAME_SAVE="存储",n.WTCD_GAME_SAVE_TITLE="请选择要存储的位置",n.WTCD_GAME_SAVE_CANCEL="取消",n.WTCD_GAME_SAVE_NEW="- 新存档 -",n.WTCD_GAME_SAVE_OVERWRITE_TITLE="是否覆盖？",n.WTCD_GAME_SAVE_OVERWRITE_CONFIRM="确认覆盖",n.WTCD_GAME_SAVE_OVERWRITE_CANCEL="取消",n.WTCD_GAME_SAVE_OK="存储成功",n.WTCD_GAME_LOAD="读取",n.WTCD_GAME_LOAD_TITLE="请选择要读取的存档",n.WTCD_GAME_LOAD_CANCEL="取消",n.WTCD_GAME_LOAD_QUICK="快",n.WTCD_GAME_LOAD_OK="读取成功",n.WTCD_GAME_QUICK_SAVE="快速存储",n.WTCD_GAME_QUICK_SAVE_OK="快速存储成功",n.WTCD_GAME_QUICK_LOAD="快速读取",n.WTCD_GAME_QUICK_LOAD_OK="快速读取成功",n.WTCD_GAME_QUICK_LOAD_NOT_EXIST="没有可用的快速存档，请先使用【快速存储】来创建快速存档。",n.WTCD_GAME_QUICK_LOAD_CONFIRM_TITLE="是否快速读取？",n.WTCD_GAME_QUICK_LOAD_CONFIRM_DESC="这会丢失当前未保存的数据。（可在【设置】中禁用此确认）",n.WTCD_GAME_QUICK_LOAD_CONFIRM_CONFIRM="确认读取",n.WTCD_GAME_QUICK_LOAD_CONFIRM_CANCEL="取消",n.WTCD_GAME_NO_DESC="无描述文本",n.WTCD_ERROR_COMPILE_TITLE="WTCD 编译失败",n.WTCD_ERROR_COMPILE_DESC="该 WTCD 文档在编译时发生了错误。请检查是否有语法错误或是其他基本错误。",n.WTCD_ERROR_RUNTIME_TITLE="WTCD 运行时错误",n.WTCD_ERROR_RUNTIME_DESC="该 WTCD 文档在运行时发生了错误。请检查是否有逻辑错误。",n.WTCD_ERROR_INTERNAL_TITLE="WTCD 内部错误",n.WTCD_ERROR_INTERNAL_DESC="WTCD 解释器在解释执行该 WTCD 文档时崩溃了。请务必告诉琳你做了什么好让她来修。",n.WTCD_ERROR_MESSAGE="错误信息：",n.WTCD_ERROR_WTCD_STACK_TITLE="WTCD 调用栈",n.WTCD_ERROR_WTCD_STACK_DESC="WTCD 调用栈记录了在错误发生时 WTCD 的解释器状态。这可以帮助理解错误发生的上下文。",n.WTCD_ERROR_INTERNAL_STACK_TITLE="内部调用栈",n.WTCD_ERROR_INTERNAL_STACK_DESC="内部调用栈记录了出现该错误时编译器或是解释器的状态。请注意内部调用栈通常只在调试 WTCD 编译器或是解释器时有用。内部调用栈通常对调试 WTCD 文档没有作用。",n.WTCD_CANVAS_LOADING="资源加载中... 取决于网络情况，这可能需要 1 秒 ~ 10 分钟。",n.GENERIC_SUCCESS_TITLE="成功",n.GENERIC_SUCCESS_DESC="操作已完成。",n.GENERIC_ERROR_TITLE="错误",n.GENERIC_ERROR_DESC="发生了错误。",n.GENERIC_LOADING_TITLE="请稍后",n.GENERIC_LOADING_DESC="正在加载...",n.GENERIC_HINT_TITLE="提示",n.GENERIC_CONFIRM="确认",n.GENERIC_CANCEL="取消",n.GENERIC_CLOSE="关闭",n.GENERIC_INTERNET_ERROR="加载失败，请检查网络连接。",n.BACKEND_ERROR_NAME_DUPLICATED="昵称已存在。如果您在此之前使用别的设备在晶体图书馆评论过，请将之前评论时自动生成的身份令牌复制到“设置” > “评论身份管理” > “身份令牌”。",n.BACKEND_ERROR_EMAIL_DUPLICATED="邮箱已存在。如果您在此之前使用别的设备在晶体图书馆评论过，请将之前评论时自动生成的身份令牌复制到“设置” > “评论身份管理” > “身份令牌”。",n.BACKEND_ERROR_NAME_TOO_LONG="昵称过长。",n.BACKEND_ERROR_EMAIL_TOO_LONG="邮箱过长。",n.BACKEND_ERROR_EMAIL_INVALID="邮箱格式不正确。晶体图书馆评论系统目前只接受常见的邮箱格式。如果您觉得您的邮箱格式并不罕见，请联系琳。",n.BACKEND_ERROR_COMMENT_TOO_LONG="评论过长。",n.BACKEND_ERROR_TOKEN_INVALID="令牌无效。",n.BACKEND_ERROR_NAME_TOO_SHORT="昵称过短。",n.BACKEND_ERROR_COMMENT_TOO_SHORT="评论过短。",n.BACKEND_ERROR_NAME_INVALID="昵称格式不正确。请确保昵称中不包含控制字符。",n.BACKEND_ERROR_UNKNOWN="发生了未知错误，请联系琳。",n.USER_TOKEN_CHANGE_EMPTY="请输入身份令牌。",n.USER_TOKEN_CHANGE_INVALID="身份令牌无效，请再次检查您输入的内容是否正确。",n.USER_TOKEN_CHANGE_CHECKING="正在确认您的身份令牌...",n.USER_TOKEN_CHANGE_SUCCESS="身份令牌设置成功",n.USER_TOKEN_CHANGE_TITLE="修改身份令牌",n.USER_TOKEN_CHANGE_DESC="这是您的身份令牌。\n使用身份令牌可以在晶体图书馆发表评论。\n当您第一次发表评论时，系统就会自动生成一个身份令牌。而后续发表的评论则会使用同一个令牌。\n您可以通过将这个令牌复制到别的电脑上来实现使用多台设备用一个身份回复。",n.USER_TOKEN_CHANGE_INPUT_LABEL="令牌：",n.USER_TOKEN_DOES_NOT_EXIST="您目前不持有身份令牌。请至少评论一次后再尝试。",n.USER_UPDATE_PROFILE_ERROR_NOT_INITIALIZED="身份信息初始化失败，请刷新页面重试。",n.USER_UPDATE_PROFILE_TITLE="修改身份信息",n.USER_UPDATE_PROFILE_DESC="您可以在此修改您在使用评论系统时的身份信息。",n.USER_UPDATE_PROFILE_HINT_USER_NAME="用户名决定他人如何在评论中 @ 您，不可修改。",n.USER_UPDATE_PROFILE_HINT_DISPLAY_NAME="昵称是显示在您发表的每一条评论上的身份标识。",n.USER_UPDATE_PROFILE_HINT_EMAIL_0="邮箱用于加载头像；若要设置头像，请",n.USER_UPDATE_PROFILE_HINT_EMAIL_GRAVATAR_LINK="点此转到 Gravatar",n.USER_UPDATE_PROFILE_HINT_EMAIL_1="，使用相同邮箱注册账号并上传头像；您的邮箱永远不会公开给其他用户。",n.USER_UPDATE_PROFILE_USER_NAME_INPUT_LABEL="用户名：",n.USER_UPDATE_PROFILE_DISPLAY_NAME_INPUT_LABEL="昵称：",n.USER_UPDATE_PROFILE_EMAIL_INPUT_LABEL="邮箱：",n.USER_UPDATE_PROFILE_DISPLAY_NAME_EMPTY="昵称不能为空。",n.USER_UPDATE_PROFILE_LOADING="正在更新您的信息...",n.USER_UPDATE_PROFILE_SUCCESS="信息更新成功！",n.AUTHOR_PAGE_WORKS="作品列表",n.AUTHOR_PAGE_WORKS_DESC="以下为$参与创作的作品。",n.AUTHOR_PAGE_AS="作为",n.AUTHOR_PAGE_LINK="链接",n.MIRROR_TITLE="镜像站选择",n.MIRROR_DESC_0_NO_TOKEN="请选择您要使用的镜像站。您的阅读历史和阅读器设置将不会被转移。",n.MIRROR_DESC_0="请选择您要使用的镜像站。您的评论身份将会被自动转移，但是阅读历史和阅读器设置将不会被转移。（转移后，您依然可以使用同样的身份在之前使用的站点评论。）",n.MIRROR_DESC_1="所有镜像站都是读者无偿提供的。如果好用，记得和提供者道一声谢哦。",n.MIRROR_URL="网址：",n.MIRROR_PROVIDED_BY="提供者：",n.MIRROR_TECHNOLOGY="技术：",n.MIRROR_LANDING_INVALID_REFERRAL="因为 referrer 错误，您的评论身份信息转移失败。",n.MIRROR_LANDING_SUCCESS_HINT="评论身份转移成功",n.MIRROR_LANDING_CONFLICT_TITLE="评论身份冲突",n.MIRROR_LANDING_CONFLICT_DESC="您刚刚使用的站点请求修改本站的评论身份。但是您之前已经在本站评论过，且使用了不同的评论身份，请问您要？",n.MIRROR_LANDING_CONFLICT_OVERWRITE="用刚刚使用的站点的评论身份覆盖本站的评论身份",n.MIRROR_LANDING_CONFLICT_KEEP="保留本站的评论身份"},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mirrorSitesPlusMainSite=n.mainSite=n.mirrorSites=void 0,n.mirrorSites=[],n.mainSite={name:"主站",origin:"https://crystaltechstudio.github.io/Library",provider:"Crystal Moling",technology:"Github Pages"},n.mirrorSitesPlusMainSite=[n.mainSite,...n.mirrorSites]},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.redirects=void 0,n.redirects=[e=>e.replace(/^chapter\/人设卡\/(.*)$/,"chapter/主线/人设卡/$1"),e=>e.replace(/^chapter\/支线\/(.*)$/,"chapter/$1"),e=>e.replace(/^menus\/书目选择\/所有书目\/支线\/(.*)$/,"menu/书目选择/所有书目/$1"),e=>e.startsWith("chapter/")&&e.endsWith(".html")&&!e.endsWith("第-1-章.html")?e.replace(/^(chapter\/.*)\.html$/,"$1/第-1-章.html"):e]},{}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getRolePriority=n.rolePriorities=void 0,n.rolePriorities=new Map;["作者","画师","编辑"].reverse().forEach(((e,t)=>n.rolePriorities.set(e,t))),n.getRolePriority=function getRolePriority(e){var t;return null!==(t=n.rolePriorities.get(e))&&void 0!==t?t:-1}},{}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.stylePreviewArticle=void 0,n.stylePreviewArticle='<h1>测试用样例文本</h1>\n<p>山性分里团决报织前流重干同今，三高格定程详克葡旷磨行。 具通接变里步群山速织适工，气人力年信料三利原历，说目流二专足称层杏。 <a href="#/menu/阅读器样式">自千有进十列证它子指</a>，想体志变建选转来，王他投询时线果。 运酸论一话目各员，听于指使身律它备，统色统维段当。 色权我克相料必每确候存，动分头越安则特交山往消，十增李霸佣包旷列旷。 <strong>象队酸族各了且适究候知自</strong>，非什消单弦严求园此。</p>\n<ul>\n<li>应学看张你，很消程，保隶验。</li>\n<li>利变马展长间亲，类认六江易联，<a href="#/menu/阅读器样式">老般及现安应</a>，治入员奋。</li>\n<li>单可便叫不住般百飞分万地，维信发生平布资交决基，安手容属实每还音。</li>\n</ul>\n<p>清义然从容主层，光斗则流专类保，九都商管。</p>\n<p>料指第接还专称感织，现技号号我平己连，了县葬辆邮资。 事步须被该，门音总示证委主，压该入按基。</p>\n<p>周走拉局数米状市越争其，治千认定具置共构须积，及见五提民投材吹。 政我照说长论易期又，离处你基丽事收。</p>\n<table>\n<thead>\n<tr>\n<th>会且广受制下东业</th>\n<th>重至图院五正况</th>\n<th>决述什叫</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>给变面些列取效想根织压</td>\n<td>取流支养世都严数任花切</td>\n<td>已劳作会励动批规</td>\n</tr>\n<tr>\n<td>权步成断飞适研强</td>\n<td>响起前程置同</td>\n<td>目验质小还</td>\n</tr>\n<tr>\n<td>目业农同美高说运</td>\n<td>研日询私构</td>\n<td>罐报盛方在</td>\n</tr>\n</tbody>\n</table>\n<p>铁看联增议上能题商，强龙技使克多改题具。 教无面选学对联设说叫，历身示所见保总委九意，间高孤精克些家。</p>\n<p>不层派离约系，样第应民观，与两清。</p>\n<p>马时他心的红在少加，强接思王向组影，得意村小精数。 阶相全型改外实阶义关，保品连半越江样提群局，酸结届万即铁传苗。</p>\n<p><a href="#/menu/阅读器样式">别干造过养状元外</a>，土面那报极火，理者杨精运长。 大观内又商流力火争学必着，每们军说是查称识场度带，他先写基陕率秧质一。 <em>县象好件周取单计四查叫极</em>，支水传据日们千走际社，名去直世建满孟陕除。 证而当阶较有别查且程有，家线最统打题问整约中，<strong>手战管论吩位周可</strong>。</p>\n<p>亲就离标线参细接，<strong>至是进白路七第</strong>，空村七该。 真和从大市我，运该可热速时，先极进业承。 还快正难天听铁直节府消，深向青律向按事点外可群，公增届太赚孝因盛切。 小安术任历形矿，下为使济者议元，传两满化葬。 两进了今切名际事，如多人问离术时节，空居茅低连。</p>\n<p>圆治号非江商你明山什，斯后民许之该白机量，两说杨孟励雪。 小据置选论性成政群始该重易，题认指山带文励百铁乱压。 金调连委义场院收员，包干数起格起验，增众医义些情园。 后没或由物长海至，被农色由可建起，界求张听线。</p>\n<p>革少已感主题布进，及生组天规东程总，飞层毛边只但孤，象小求标验。</p>\n<p>包高她过级定史省少前发议，步资志十图气小己点头做，切叫水县度油更看张。</p>\n<p>例会造值面象油会太例，府现阶出低对名边心往，层里更县材周分志。 强不共支常类并决，音他展斗色除片着，照苍清此例。 酸济图将般确头最治选，近行新总青切府权，解安呜定空小。</p>\n<p>战经确委件用以却求角除问，它之需装化隶三长身按。</p>\n<p>用金转后每状立细文历市，<a href="#/menu/阅读器样式">多马过清中入带表已与</a>，点极日解型苍除坝。 书由四思门始号山存，界林了开此们断，容周回林时秃。 科料装四农千把心根下受，色离与改元切指该高，制水增称多坟。 而多天直引图理电别亲二引，红什事战场没解议情，深结道知批历被象。 <strong>变各育完走发加工基，象斯导角太要眼受习，容束法他苍块命。</strong> 引数安儿放能设片面，为世都时个照济，已周队数成空。 天没书少领精生济，位用求旷极。</p>'},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.thanks=void 0,n.thanks=[{name:"",link:""}].sort((()=>Math.random()-.5))},{}],19:[function(e,t,n){"use strict";function solveQuad(e,t,n){const i=t**2-4*e*n;return(-t+function sign(e){return e>0?1:e<0?-1:0}(e)*i**.5)/(2*e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MonoDimensionTransitionControl=void 0;n.MonoDimensionTransitionControl=class MonoDimensionTransitionControl{constructor(e,t){this.lastValue=e,this.initialTime=0,this.reverseTime=0,this.reverseValue=0,this.reverseVelocity=0,this.lastStartingVelocity=0,this.finalTime=0,this.finalValue=0,this.acceleration=0,this.finalValue=e,this.acceleration=t/1e3/1e3}setTarget(e){this.lastValue=this.getValue();const t=e-this.lastValue;if(0===t)return;const n=Date.now(),i=this.getVelocity(n);let a=solveQuad(this.acceleration,2*i,.5*i**2/this.acceleration-t);(Number.isNaN(a)||a<0)&&(this.acceleration=-this.acceleration,a=solveQuad(this.acceleration,2*i,.5*i**2/this.acceleration-t));const s=this.acceleration;this.initialTime=n,this.reverseTime=this.initialTime+a,this.reverseValue=this.lastValue+.5*s*a**2+i*a,this.reverseVelocity=i+s*a,this.finalTime=this.reverseTime+a+i/s,this.lastStartingVelocity=i,this.finalValue=e}getVelocity(e=Date.now()){return e<this.reverseTime?this.lastStartingVelocity+(e-this.initialTime)*this.acceleration:e<this.finalTime?this.lastStartingVelocity+(2*this.reverseTime-this.initialTime-e)*this.acceleration:0}getValue(e=Date.now()){if(e<this.reverseTime){const t=e-this.initialTime;return this.lastValue+.5*this.acceleration*t**2+this.lastStartingVelocity*t}if(e<this.finalTime){const t=e-this.reverseTime;return this.reverseValue-.5*this.acceleration*t**2+this.reverseVelocity*t}return this.finalValue}isFinished(e=Date.now()){return e>=this.finalTime}}},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("./backendControl"),a=e("../data/AutoCache"),s=e("../DebugLogger"),l=e("./chapterControl"),c=new a.AutoCache((e=>fetch(i.backendUrl+"/stats/count",{method:"POST",body:e})),new s.DebugLogger("Analytics Cache"));l.loadChapterEvent.on((e=>{if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)return;const t=window.location.hash.split("~")[0];setTimeout((()=>{t===window.location.hash.split("~")[0]&&c.get(e)}),5e3)}))},{"../DebugLogger":9,"../data/AutoCache":39,"./backendControl":21,"./chapterControl":22}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fetchDeleteComment=n.fetchRegister=n.fetchSendComment=n.fetchGetRecentMentionedComments=n.fetchGetRecentComments=n.fetchGetChapterComments=n.fetchUpdateProfile=n.fetchInit=n.getErrorMessage=n.ErrorCode=n.backendUrl=void 0;const i=e("../constant/messages");var a;n.backendUrl="https://wtb.tepis.me",function(e){e[e.NAME_DUPLICATED=1]="NAME_DUPLICATED",e[e.EMAIL_DUPLICATED=2]="EMAIL_DUPLICATED",e[e.NAME_TOO_LONG=3]="NAME_TOO_LONG",e[e.EMAIL_TOO_LONG=4]="EMAIL_TOO_LONG",e[e.EMAIL_INVALID=5]="EMAIL_INVALID",e[e.COMMENT_TOO_LONG=6]="COMMENT_TOO_LONG",e[e.TOKEN_INVALID=7]="TOKEN_INVALID",e[e.NAME_TOO_SHORT=8]="NAME_TOO_SHORT",e[e.COMMENT_TOO_SHORT=9]="COMMENT_TOO_SHORT",e[e.NAME_INVALID=10]="NAME_INVALID"}(a=n.ErrorCode||(n.ErrorCode={})),n.getErrorMessage=function getErrorMessage(e){switch(e){case a.NAME_DUPLICATED:return i.BACKEND_ERROR_NAME_DUPLICATED;case a.EMAIL_DUPLICATED:return i.BACKEND_ERROR_EMAIL_DUPLICATED;case a.NAME_TOO_LONG:return i.BACKEND_ERROR_NAME_TOO_LONG;case a.EMAIL_TOO_LONG:return i.BACKEND_ERROR_EMAIL_TOO_LONG;case a.EMAIL_INVALID:return i.BACKEND_ERROR_EMAIL_INVALID;case a.COMMENT_TOO_LONG:return i.BACKEND_ERROR_COMMENT_TOO_LONG;case a.TOKEN_INVALID:return i.BACKEND_ERROR_TOKEN_INVALID;case a.NAME_TOO_SHORT:return i.BACKEND_ERROR_NAME_TOO_SHORT;case a.COMMENT_TOO_SHORT:return i.BACKEND_ERROR_COMMENT_TOO_SHORT;case a.NAME_INVALID:return i.BACKEND_ERROR_NAME_INVALID;default:return i.BACKEND_ERROR_UNKNOWN}},n.fetchInit=function fetchInit(e){return fetch(`${n.backendUrl}/user/init`,{cache:"no-cache",method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({token:e})}).then((e=>e.json()))},n.fetchUpdateProfile=function fetchUpdateProfile(e,t,i){return fetch(`${n.backendUrl}/user/updateProfile`,{cache:"no-cache",method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({token:e,display_name:t,email:i})}).then((e=>e.json()))},n.fetchGetChapterComments=function fetchGetChapterComments(e){return fetch(`${n.backendUrl}/comment/getChapter?relative_path=${e}`,{cache:"no-cache",method:"GET"}).then((e=>e.json()))},n.fetchGetRecentComments=function fetchGetRecentComments(){return fetch(`${n.backendUrl}/comment/getRecent`,{cache:"no-cache",method:"GET"}).then((e=>e.json()))},n.fetchGetRecentMentionedComments=function fetchGetRecentMentionedComments(e){return void 0===e?Promise.resolve([]):fetch(`${n.backendUrl}/comment/getRecentMentioned`,{cache:"no-cache",method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({token:e})}).then((e=>e.json()))},n.fetchSendComment=function fetchSendComment(e,t,i){return fetch(`${n.backendUrl}/comment/send`,{cache:"no-cache",method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({token:e,relative_path:t,content:i})}).then((e=>e.json()))},n.fetchRegister=function fetchRegister(e,t){return fetch(`${n.backendUrl}/user/register`,{cache:"no-cache",method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({display_name:e,email:t})}).then((e=>e.json()))},n.fetchDeleteComment=function fetchDeleteComment(e,t){return fetch(`${n.backendUrl}/comment/delete`,{cache:"no-cache",method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({token:e,comment_id:t})}).then((()=>{}))}},{"../constant/messages":13}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.chapterPathHandler=n.ErrorType=n.canChapterShown=n.loadChapterEvent=void 0;const i=e("../$e"),a=e("../constant/messages"),s=e("../data/AutoCache"),l=e("../data/data"),c=e("../data/hrefs"),u=e("../data/readingProgress"),d=e("../data/settings"),E=e("../DebugLogger"),_=e("../Event"),p=e("../hs"),m=e("../input/gestures"),f=e("../input/keyboard"),C=e("../util/DOM"),g=e("../util/formatRelativePath"),T=e("../util/string"),N=e("../util/tag"),I=e("../util/throttle"),M=e("../util/urlArguments"),O=e("./pushHelper"),S=e("./commentsControl"),R=e("./contentControl"),L=e("./followQuery"),v=e("./layoutControl"),A=e("./menuControl"),D=e("./modalControl"),y=e("./navbarControl"),w=e("./processElements"),b=e("./preloaderBlock"),P=new E.DebugLogger("Chapter Control");n.loadChapterEvent=new _.Event;let U=null;const select=(e,[t,n,i,a])=>{const s=e[t],l=e[i];if(void 0===s||void 0===l)return;document.getSelection().setBaseAndExtent(s,n,l,a);const c=s.parentElement;null!==c&&"function"==typeof c.scrollIntoView&&c.scrollIntoView()};function canChapterShown(e){return(d.earlyAccess.getValue()||!e.isEarlyAccess)&&!e.hidden&&(d.showAbandonedChapters.getValue()||!e.abandoned)}function findNextChapter(e){const t=e.inFolderIndex,n=e.folder.children;for(let e=t+1;e<n.length;e++){const t=n[e];if("folder"!==t.type&&canChapterShown(t))return t}return null}function findPreviousChapter(e){const t=e.inFolderIndex,n=e.folder.children;for(let e=t-1;e>=0;e--){const t=n[e];if("folder"!==t.type&&canChapterShown(t))return t}return null}function getChapterRelativeLink(e){return`${window.location.pathname}#/chapter/${e.htmlRelativePath}`}function navigateToChapter(e){window.location.href=getChapterRelativeLink(e)}n.canChapterShown=canChapterShown;const k=new s.AutoCache((e=>{const t=`./chapters/${e}`;return P.log(`Loading chapter from ${t}.`),fetch(t).then((e=>e.text()))}),new E.DebugLogger("Chapters Cache"));function loadChapter(e,t,s=R.Side.LEFT){P.log("Load chapter",e,"with selection",t),n.loadChapterEvent.emit(e);const E=l.relativePathLookUpMap.get(e);U=E,document.title=(0,g.formatRelativePath)(e)+" - 晶体图书馆",window.history.replaceState(null,document.title),function updateNavbar(e){(0,y.setNavbarPath)([{display:"所有书目",hash:"#/menu/书目选择/所有书目"},...e.split("/").map(((e,t,n)=>(e=e.replace(/-/g," "),t===n.length-1?{display:(0,T.removePotentialSuffix)(e,".html"),hash:null}:{display:e,hash:`#/menu/书目选择/所有书目/${n.slice(0,t+1).join("/")}`})))])}(e);const _=(0,R.newContent)(s);!function maybeAddEarlyAccessWarning(e,t){e.chapter.isEarlyAccess&&t.addBlock({initElement:(0,i.$e)("div",null,(0,i.$e)("h1",null,"编写中章节"),(0,i.$e)("p",null,"请注意，本文正在编写中，因此可能会含有未完成的句子或是尚未更新的信息。")),style:R.ContentBlockStyle.WARNING})}(E,_),function maybeAddAbandonedWarning(e,t){e.chapter.abandoned&&t.addBlock({initElement:(0,i.$e)("div",null,(0,i.$e)("h1",null,"弃坑警告"),(0,i.$e)("p",null,"本文作者已弃坑，文章内容并不完整。")),style:R.ContentBlockStyle.WARNING})}(E,_),function maybeAddNonEroticWarning(e,t){e.chapter.htmlRelativePath.startsWith("小作品/")&&t.addBlock({initElement:(0,i.$e)("div",null,(0,i.$e)("h1",null,"本文是小作品"),(0,i.$e)("p",null,"请注意，本文是小作品。小作品是任由作者发挥的投稿类型，文章通常为生草文，而不一定色情。")),style:R.ContentBlockStyle.WARNING})}(E,_);const $=(0,b.addPreloaderBlock)(_);function loadPrevChapter(){const e=findPreviousChapter(E);null!==e&&navigateToChapter(e)}function loadNextChapter(){const e=findNextChapter(E);null!==e&&navigateToChapter(e)}(0,v.setLayout)(v.Layout.MAIN),function registerSwipeEvents(e,t,n){m.swipeEvent.onUntil((n=>{d.gestureSwitchChapter.getValue()&&((0,D.isAnyModalOpened)()||(n===m.SwipeDirection.TO_RIGHT?e():n===m.SwipeDirection.TO_LEFT&&t()))}),n.leavingEvent)}(loadPrevChapter,loadNextChapter,_),function registerArrowKeyEvents(e,t,n){f.arrowKeyPressEvent.onUntil((n=>{(0,D.isAnyModalOpened)()||(n===f.ArrowKey.LEFT?e():n===f.ArrowKey.RIGHT&&t())}),n.leavingEvent)}(loadPrevChapter,loadNextChapter,_),function attachEscapeEvent(e){f.escapeKeyPressEvent.onUntil((()=>{(0,D.isAnyModalOpened)()||(0,A.enterMenuMode)()}),e.leavingEvent)}(_),k.get(e).then((e=>{if(_.isDestroyed)return void P.log("Chapter loaded, but abandoned since the original content page is already destroyed.");P.log("Chapter loaded."),$.directRemove(),_.appendLeftSideContainer();const n=function insertContent(e,t,n){if("Markdown"===n.type)return function loadMarkdown(e,t){const n=e.addBlock();return n.element.innerHTML=t,(0,w.processElements)(n.element),n}(e,t)}(_,e,E.chapter),s=null!=n?n:_.addBlock();_.appendRightSideContainer(),function addAuthorsInfoBlock(e,t){if(t.authors.length>0){const n=(0,p.h)(".authors",(0,p.h)("h3","本文作者"),(0,p.h)(".outer-container",...t.authors.map((e=>{var t;const n=null!==(t=l.authorInfoMap.get(e.name))&&void 0!==t?t:{name:e.name,avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(e.name)}`};return(0,p.h)(".author-container",{onclick:()=>{window.history.pushState(null,document.title,(0,c.pageHref)(`author/${n.name}`)),(0,L.followQuery)()}},(0,p.h)("img.avatar",{src:n.avatar}),(0,p.h)(".author-role-container",(0,p.h)(".role",e.role),(0,p.h)(".name",n.name)))})),(0,p.h)(".reprint",{href:"#",onclick:e=>{e.preventDefault();const n=new D.Modal((0,p.h)("div",(0,p.h)("h1","转载须知"),(0,p.h)("p","晶体图书馆内所有文章均以 ",(0,p.h)("a.regular",{target:"_blank",href:"https://creativecommons.org/licenses/by-nc-nd/4.0/",rel:"noopener noreferrer"},"CC BY-NC-ND 4.0")," 协议发布。转载时请注明以下信息："),(0,p.h)("pre.wrapping",(0,p.h)("code","本文内容摘自晶体图书馆（https://crystaltechstudio.github.io/Library）。"+t.authors.map((e=>e.role+"："+e.name)).join("，")+"。本文以 CC BY-NC-ND 4.0 协议发布，转载请注明上述所有信息。")),(0,p.h)(".button-container",[(0,p.h)("div",{onclick:()=>{n.close()}},"我知道了")])));n.setDismissible(),n.open()}},(0,p.h)("div","转载须知"))));e.addBlock({initElement:n,side:R.ContentBlockSide.LEFT})}}(_,E.chapter),function addTagInfoBlock(e,t){void 0!==t.tags?e.addBlock({initElement:(0,i.$e)("div",{className:"tags"},(0,i.$e)("h3",null,"本文标签"),t.tags.map((e=>(0,i.$e)("a",{href:(0,c.tagSearchHref)(e)},(0,N.tagSpan)(e,!1))))),side:R.ContentBlockSide.LEFT}):t.htmlRelativePath.includes("META")||e.addBlock({initElement:(0,i.$e)("div",null,(0,i.$e)("h3",null,"本文标签缺失"),(0,i.$e)("p",null,"本文目前没有标签。如果你愿意帮忙打标签，请",(0,i.$e)("a",{className:"regular",href:(0,c.chapterHref)("META/协助打标签.html")},"至此查看协助打标签的方式"),"。")),side:R.ContentBlockSide.LEFT})}(_,E.chapter),(0,O.addPushHelperBlock)(_,E.chapter);const d=(0,C.getTextNodes)(s.element);!function restoreSelections(e,t){void 0!==e&&(null===(0,C.id)("warning")?select(t,e):(0,C.id)("warning").addEventListener("click",(()=>{select(t,e)})))}(t,d),function registerSelectionChangeListener(e,t){const n=function getSelectionChangeListener(e){return(0,I.smartThrottle)((()=>{const t=document.getSelection(),n=new Map;if(null!==t){const i=t.anchorNode instanceof HTMLElement?t.anchorNode.firstChild:t.anchorNode,a=e.indexOf(i),s=t.focusNode instanceof HTMLElement?t.focusNode.firstChild:t.focusNode,l=e.indexOf(s);-1===a||-1===l||a===l&&t.anchorOffset===t.focusOffset||(a<l||a===l&&t.anchorOffset<t.focusOffset?n.set("selection",`${a},${t.anchorOffset},${l},${t.focusOffset}`):n.set("selection",`${l},${t.focusOffset},${a},${t.anchorOffset}`))}(0,M.resetUrlArgumentsTo)(n)}),250)}(e);document.addEventListener("selectionchange",n),t.leavingEvent.once((()=>{document.removeEventListener("selectionchange",n)}))}(d,_),function addPageSwitcherBlock(e,t){const n=findPreviousChapter(e),i=findNextChapter(e);t.element.appendChild((0,p.h)("div.page-switcher",[null!==n?(0,p.h)("a",{href:getChapterRelativeLink(n)},a.PREVIOUS_CHAPTER):null,(0,p.h)("a",{href:window.location.pathname,onclick:e=>{e.preventDefault(),(0,A.enterMenuMode)()}},a.GO_TO_MENU),null!==i?(0,p.h)("a",{href:getChapterRelativeLink(i)},a.NEXT_CHAPTER):null]))}(E,s),function startUpdatingProgressBar(e,t,n){if(void 0!==e){const i=(0,I.smartThrottle)((()=>{const i=e.element.clientHeight-t.$element.clientHeight;let a;a=i>0?(t.$element.scrollTop-e.element.offsetTop)/i:t.$element.scrollTop+t.$element.clientHeight>e.element.offsetTop+e.element.clientHeight?1:0,a=Math.min(a,1),a=Math.max(a,0),(0,y.setProgressIndicator)(a),(0,u.updateChapterProgress)(n.chapter.htmlRelativePath,a).catch((e=>P.warn(`Failed to save chapter progress for ${n.chapter.htmlRelativePath}:`,e)))}),100);t.scrollEvent.on((()=>{i()})),t.leavingEvent.on((()=>{(0,y.resetProgressIndicator)()}))}}(n,_,E),setTimeout((()=>{(0,R.focus)()}),1),(0,S.loadChapterComments)(E,_)})).catch((e=>{P.error("Failed to load chapter.",e),$.element.innerText=a.CHAPTER_FAILED}))}!function(e){e[e.COMPILE=0]="COMPILE",e[e.RUNTIME=1]="RUNTIME",e[e.INTERNAL=2]="INTERNAL"}(n.ErrorType||(n.ErrorType={})),n.chapterPathHandler=function chapterPathHandler(e,t){const n=function followQueryToChapter(e,t){const n=l.relativePathLookUpMap.get(e);if(void 0===n)return!1;const i=null!==U&&n.inFolderIndex<U.inFolderIndex?R.Side.LEFT:R.Side.RIGHT,a=t.has("selection")?t.get("selection").split(",").map((e=>+e)):[];return 4===a.length&&a.every((e=>e>=0&&e%1==0&&!Number.isNaN(e)&&Number.isFinite(e)))?loadChapter(e,a,i):loadChapter(e,void 0,i),!0}(e,t);return n}},{"../$e":8,"../DebugLogger":9,"../Event":10,"../constant/messages":13,"../data/AutoCache":39,"../data/data":40,"../data/hrefs":42,"../data/readingProgress":43,"../data/settings":44,"../hs":45,"../input/gestures":47,"../input/keyboard":48,"../util/DOM":62,"../util/formatRelativePath":65,"../util/string":70,"../util/tag":72,"../util/throttle":73,"../util/urlArguments":74,"./commentsControl":23,"./contentControl":24,"./followQuery":25,"./layoutControl":27,"./menuControl":28,"./modalControl":30,"./navbarControl":31,"./preloaderBlock":34,"./processElements":35,"./pushHelper":36}],23:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.loadRecentMentions=n.loadRecentComments=n.loadChapterComments=n.promptComment=n.sendComment=n.createToMenuButton=void 0;const a=e("../constant/messages"),s=e("../data/AutoCache"),l=e("../data/hrefs"),c=e("../data/settings"),u=e("../DebugLogger"),d=e("../hs"),E=e("../util/DOM"),_=e("../util/formatRelativePath"),p=e("../util/formatTime"),m=e("../util/padName"),f=e("./backendControl"),C=e("./menuControl"),g=e("./modalControl"),T=e("./userControl"),N=new u.DebugLogger("Comments Control");function createCommentElement(e,t,n){var s;const c=e.relative_path,u=e.user.user_name===(null===(s=(0,T.getCurrentUser)())||void 0===s?void 0:s.userName)?(0,d.h)("a.action",{onclick:()=>{(function promptDeleteComment(e,t){return i(this,void 0,void 0,(function*(){if(yield(0,g.confirm)(a.COMMENTS_DELETE,a.COMMENTS_DELETE_CONFIRMATION,a.GENERIC_CONFIRM,a.GENERIC_CANCEL)){const n=(0,g.showGenericLoading)(a.COMMENTS_DELETING);try{yield(0,f.fetchDeleteComment)(T.tokenItem.getValue(),t)}catch(e){return(0,g.showGenericError)(a.GENERIC_INTERNET_ERROR),N.error(e),!1}finally{n.close()}return M.delete(),I.delete(e),!0}return!1}))})(c,e.id).then((e=>{e&&E.remove()}))}},a.COMMENTS_DELETE):c&&(0,d.h)("a.action",{onclick:()=>{promptComment(c,"@"+e.user.user_name+" ").then((e=>{e&&t()}))}},a.COMMENTS_REPLY),E=(0,d.h)(".comment",[(0,d.h)("img.avatar",{src:e.user.avatar_url}),(0,d.h)(".author",e.user.display_name),(0,d.h)(".time",a.COMMENTS_SUBMIT_BY.replace("$",` @${e.user.user_name} `)+(0,p.formatTimeRelative)(new Date(e.create_timestamp))+(e.create_timestamp===e.update_timestamp?"":a.COMMENTS_MODIFIED_DATE.replace("$",(0,p.formatTimeRelative)(new Date(e.update_timestamp))))),u,...e.body.split("\n\n").map((e=>(0,d.h)("p",e))),n?(0,d.h)("p",(0,d.h)("a.dimmed",{href:(0,l.chapterHref)(c)},`发表于${(0,m.padName)((0,_.formatRelativePath)(c))}`)):null]);return E}function loadComments(e,t,n,i,s,l=!0,c){const u=(0,d.h)("p",a.COMMENTS_LOADING),E=(0,d.h)(".comments",[(0,d.h)("h1",n),u]),_=e.addBlock({initElement:E});return _.onEnteringView((()=>{t().then((t=>{if(e.isDestroyed)return void N.log("Comments loaded, but abandoned since the original content page is already destroyed.");N.log("Comments loaded."),u.innerText=i;const appendCreateComment=e=>{E.appendChild((0,d.h)(".create-comment",{onclick:()=>{promptComment(e).then((e=>{e&&s()}))}},a.COMMENTS_SEND))};void 0!==c&&t.length>=6&&appendCreateComment(c),t.forEach((e=>{E.appendChild(createCommentElement(e,s,void 0===c))})),void 0!==c&&appendCreateComment(c)})).catch((e=>{u.innerText=a.COMMENTS_FAILED,N.error("Failed to load comments.",e)})).then((()=>{l&&E.appendChild(createToMenuButton())}))})),_}function createToMenuButton(){return(0,d.h)("div.page-switcher",[(0,d.h)("a",{href:window.location.pathname,onclick:e=>{e.preventDefault(),(0,C.enterMenuMode)()}},a.GO_TO_MENU)])}function sendComment(e,t,n){return i(this,void 0,void 0,(function*(){let i;try{i=yield(0,f.fetchSendComment)(e,t,n)}catch(e){return(0,g.showGenericError)(a.GENERIC_INTERNET_ERROR),N.error(e),!1}return i.success?(M.delete(),I.delete(t),!0):((0,g.showGenericError)((0,f.getErrorMessage)(i.code)),!1)}))}function promptComment(e,t){return new Promise(((n,s)=>{const l=(0,d.h)("input"),c=(0,d.h)("input"),u=(0,T.getCurrentUser)(),_=(0,d.h)("span"),updateDisplayName=()=>{null!==u&&(_.innerText=(0,m.padName)(u.displayName))};updateDisplayName();const p=T.tokenItem.exists()?null===u?(0,d.h)("div",{style:{"margin-bottom":"0.8em"}}):(0,d.h)("p",[a.COMMENTS_SEND_DISPLAY_NAME_0,_,a.COMMENTS_SEND_DISPLAY_NAME_1,(0,E.linkButton)(a.COMMENTS_SEND_DISPLAY_NAME_EDIT,(()=>{(0,T.showUpdateProfileModal)().then(updateDisplayName)}))]):[(0,d.h)(".input-group",[(0,d.h)("span",a.COMMENTS_SEND_DISPLAY_NAME_PREFIX),l]),(0,d.h)(".input-group",[(0,d.h)("span",a.COMMENTS_SEND_EMAIL_INPUT_PREFIX),c])],f=(0,d.h)("textarea.general.large");void 0!==t&&(f.value=t);const onSubmit=()=>i(this,void 0,void 0,(function*(){const t=(0,g.showGenericLoading)(a.COMMENTS_SENDING);try{return!(!T.tokenItem.exists()&&!(yield(0,T.registerWithResultPopup)(l.value,""===c.value.trim()?null:c.value)))&&(yield sendComment(T.tokenItem.getValue(),e,f.value))}finally{t.close()}})),C=new g.Modal((0,d.h)("div",[(0,d.h)("h1",a.COMMENTS_SEND_TITLE),(0,d.h)("p",a.COMMENTS_SEND_HINT),f,p,(0,d.h)(".button-container",[(0,d.h)("div",{onclick:()=>{onSubmit().then((e=>(e&&(C.close(),n(!0)),e))).catch(s)}},a.COMMENTS_SEND_CONFIRM),(0,d.h)("div",{onclick:()=>{""===f.value?(C.close(),n(!1)):(0,g.confirm)(a.COMMENTS_LOSE_EDITED_TITLE,"",a.COMMENTS_LOSE_EDITED_CONFIRM,a.COMMENTS_LOSE_EDITED_CANCEL).then((e=>{e&&(C.close(),n(!1))}))}},a.GENERIC_CANCEL)])]));C.open(),f.focus(),(0,E.autoExpandTextArea)(f)}))}n.createToMenuButton=createToMenuButton,n.sendComment=sendComment,n.promptComment=promptComment;const I=new s.AutoCache(f.fetchGetChapterComments,new u.DebugLogger("Chapter Comments Cache"));n.loadChapterComments=function loadChapterComments(e,t){if(!1===c.useComments.getValue())return;let n=null;const i=e.chapter.htmlRelativePath;!function load(){null!==n&&n.directRemove(),n=loadComments(t,(()=>I.get(i)),a.COMMENTS_SECTION,a.COMMENTS_LOADED,load,!1,e.chapter.htmlRelativePath)}()};const M=new s.AutoSingleCache(f.fetchGetRecentComments,new u.DebugLogger("Recent Comments Cache"));n.loadRecentComments=function loadRecentComments(e){let t=null;!function load(){null!==t&&t.directRemove(),t=loadComments(e,(()=>M.get()),a.COMMENTS_RECENT_SECTION,a.COMMENTS_RECENT_LOADED,load)}()};const O=new s.AutoSingleCache((()=>{var e;return(0,f.fetchGetRecentMentionedComments)(null!==(e=T.tokenItem.getValue())&&void 0!==e?e:void 0)}),new u.DebugLogger("Recent Mentioned Comments Cache"));n.loadRecentMentions=function loadRecentMentions(e,t){loadComments(e,(()=>O.get()),a.COMMENTS_MENTION_SECTION,a.COMMENTS_MENTION_LOADED,(()=>{(0,g.notify)(a.COMMENTS_MENTION_REPLIED_TITLE,"",a.COMMENTS_MENTION_REPLIED_OK)}))}},{"../DebugLogger":9,"../constant/messages":13,"../data/AutoCache":39,"../data/hrefs":42,"../data/settings":44,"../hs":45,"../util/DOM":62,"../util/formatRelativePath":65,"../util/formatTime":66,"../util/padName":68,"./backendControl":21,"./menuControl":28,"./modalControl":30,"./userControl":38}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ContentBlock=n.ContentBlockSide=n.Content=n.ContentBlockStyle=n.newContent=n.contentChangeEvent=n.contentScrollEvent=n.focus=n.getCurrentContent=n.Side=void 0;const i=e("../$e"),a=e("../data/settings"),s=e("../DebugLogger"),l=e("../Event"),c=e("../hs"),u=e("../input/keyboard"),d=e("../util/DOM"),E=e("./layoutControl"),_=e("./MonoDimensionTransitionControl"),p=(0,d.id)("content-container"),m=new s.DebugLogger("Content Control");var f;function setSide(e,t){t===f.LEFT?(e.classList.add("left"),e.classList.remove("right")):(e.classList.add("right"),e.classList.remove("left"))}!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"}(f=n.Side||(n.Side={}));let C=null;var g,T;n.getCurrentContent=function getCurrentContent(){return C},n.focus=function focus(){null!==C&&C.$element.focus({preventScroll:!0})},n.contentScrollEvent=new l.Event,n.contentChangeEvent=new l.Event,n.newContent=function newContent(e){const t=new Content;if(null==C||C.ensureLeavingTriggered(),(0,E.getCurrentLayout)()===E.Layout.OFF)null!==C&&C.destroy();else if(a.animation.getValue()){if(null!==C){setSide(C.$element,function otherSide(e){return e===f.LEFT?f.RIGHT:f.LEFT}(e));const t=C;setTimeout((()=>{t.destroy()}),2500)}setSide(t.$element,e),(0,d.forceReflow)(t.$element),t.$element.classList.remove("left","right")}else null!==C&&C.destroy();return C=t,n.contentChangeEvent.emit({newContent:t}),t},function(e){e[e.REGULAR=0]="REGULAR",e[e.WARNING=1]="WARNING"}(g=n.ContentBlockStyle||(n.ContentBlockStyle={}));class Content{constructor(){this.isDestroyed=!1,this.blocks=[],this.scrollTransition=null,this.leavingEvent=new l.Event,this.scrollEvent=new l.Event,this.leavingTriggered=!1,this.$leftSideContainer=null,this.$rightSideContainer=null,this.onKeyPress=e=>{e!==u.ArrowKey.UP&&e!==u.ArrowKey.DOWN||this.interruptScrolling()},this.interruptScrolling=()=>{null!==this.scrollTransition&&(this.scrollTransition=null,m.log("Transition interrupted."))},this.scrollAnimation=()=>{if(null===this.scrollTransition)return;const e=Date.now();this.$element.scrollTop=this.scrollTransition.getValue(e),this.scrollTransition.isFinished(e)?(m.log("Transition finished."),this.scrollTransition=null):requestAnimationFrame(this.scrollAnimation)};const e=(0,c.h)("div.content",{tabIndex:-1});p.appendChild(e),this.$element=e,this.$element.addEventListener("wheel",(()=>{this.interruptScrolling()}),{passive:!0}),this.$element.addEventListener("scroll",(()=>{this.scrollEvent.emit({scrollTop:this.$element.scrollTop}),n.contentScrollEvent.emit({scrollTop:this.$element.scrollTop})}),{passive:!0}),u.arrowKeyPressEvent.on(this.onKeyPress),E.layoutChangeEvent.on((({newLayout:e},t)=>{e===E.Layout.OFF&&(this.ensureLeavingTriggered(),E.layoutChangeEvent.off(t))}))}appendLeftSideContainer(){if(null!==this.$leftSideContainer)throw new Error("Left side container already exists.");this.$leftSideContainer=(0,i.$e)("div",{className:"left-side-container"}),this.$element.append(this.$leftSideContainer)}appendRightSideContainer(){if(null!==this.$rightSideContainer)throw new Error("Right side container already exists.");this.$rightSideContainer=(0,i.$e)("div",{className:"right-side-container"}),this.$element.append(this.$rightSideContainer)}getLeftSideContainer(){if(null===this.$leftSideContainer)throw new Error("Left side container does not exist.");return this.$leftSideContainer}getRightSideContainer(){if(null===this.$rightSideContainer)throw new Error("Right side container does not exist.");return this.$rightSideContainer}ensureLeavingTriggered(){this.leavingTriggered||(m.log("Triggering leaving event."),this.leavingTriggered=!0,this.leavingEvent.emit())}addBlock(e={}){const t=new ContentBlock(this,e);return this.blocks.push(t),t}destroy(){this.isDestroyed=!0,this.$element.remove(),window.removeEventListener("wheel",this.interruptScrolling),u.arrowKeyPressEvent.off(this.onKeyPress)}scrollTo(e){if(!a.animation.getValue()||(0,E.getCurrentLayout)()===E.Layout.OFF)return m.log(`Scroll to ${e}, no animation.`),void(this.$element.scrollTop=e);null===this.scrollTransition?(m.log(`Scrolling to ${e}, new transition stared.`),this.scrollTransition=new _.MonoDimensionTransitionControl(this.$element.scrollTop,2e4),this.scrollTransition.setTarget(e),requestAnimationFrame(this.scrollAnimation)):(m.log(`Scrolling to ${e}, existing transition updated.`),this.scrollTransition.setTarget(e))}}n.Content=Content,function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"}(T=n.ContentBlockSide||(n.ContentBlockSide={}));class ContentBlock{constructor(e,{initElement:t=(0,c.h)("div"),style:n=g.REGULAR,slidable:i=!1,prepend:a=!1,side:s}){if(this.slideContainer=null,this.heightHolder=null,this.sliding=0,!(t instanceof HTMLDivElement))throw new Error("Init element must be a div.");if(void 0!==s&&i)throw new Error('"side" and "slidable" are incompatible.');if(this.element=t,t.classList.add("content-block"),n===g.WARNING)t.classList.add("warning");let l=e.$element,u=t;i&&(this.slideContainer=(0,c.h)(".slide-container",u),u=this.slideContainer),s===T.LEFT?l=e.getLeftSideContainer():s===T.RIGHT&&(l=e.getRightSideContainer()),a?l.prepend(u):l.append(u)}hide(){return this.element.classList.add("display-none"),this}show(){return this.element.classList.remove("display-none"),this}onEnteringView(e){const t=new IntersectionObserver((n=>{n[0].isIntersecting&&(t.disconnect(),e())}),{root:p,threshold:0});t.observe(this.element)}directRemove(){null!==this.slideContainer?this.slideContainer.remove():this.element.remove()}directReplace(e=(0,c.h)("div")){e.classList.add("content-block"),this.element.parentElement.replaceChild(e,this.element),this.element=e}slideReplace(e=(0,c.h)("div")){if(!a.animation.getValue())return void this.directReplace(e);const t=this.slideContainer;if(null===t)throw new Error("Content block is not slidable.");this.sliding++,t.classList.add("in-transition"),e.classList.add("content-block");const n=this.element;e.classList.add("right"),t.prepend(e);const i=e.offsetHeight;e.classList.remove("right"),null===this.heightHolder&&(this.heightHolder=(0,c.h)(".height-holder"),this.heightHolder.style.height=`${n.offsetHeight}px`,t.appendChild(this.heightHolder),(0,d.forceReflow)(this.heightHolder)),this.heightHolder.style.height=`${i}px`,n.classList.add("left"),this.element=e,setTimeout((()=>{n.remove(),this.sliding--,0===this.sliding&&(t.classList.remove("in-transition"),null!==this.heightHolder&&(this.heightHolder.remove(),this.heightHolder=null))}),2500)}}n.ContentBlock=ContentBlock},{"../$e":8,"../DebugLogger":9,"../Event":10,"../data/settings":44,"../hs":45,"../input/keyboard":48,"../util/DOM":62,"./MonoDimensionTransitionControl":19,"./layoutControl":27}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.followQuery=n.initPathHandlers=n.onPathHandled=void 0;const i=e("../constant/messages"),a=e("../constant/redirects"),s=e("../DebugLogger"),l=e("../Event"),c=e("./chapterControl"),u=e("./menuControl"),d=e("./mirrorControl"),E=e("./modalControl"),_=e("./pageControl"),p=new s.DebugLogger("Follow Query");let m;n.onPathHandled=new l.Event,n.initPathHandlers=function initPathHandlers(){m=new Map([["chapter",c.chapterPathHandler],["page",_.pagePathHandler],["menu",u.menuPathHandler],["mirror-landing",d.mirrorLandingHandler]])},n.followQuery=function followQuery(){if(""===window.location.hash)return document.title="晶体图书馆",void(0,u.handleMainMenu)();const e=window.location.hash.split("~").map(decodeURIComponent);let t=e[0];const s=new Map(e.slice(1).map((e=>{const t=e.split("=");return 2===t.length?[t[0],t[1]]:[t[0],""]})));if(!t.startsWith("#/")&&(t=`#/chapter/${t.substr("#".length)}`,""!==window.location.search)){const e=/^\?selection=((?:0|[1-9][0-9]*),(?:0|[1-9][0-9]*),(?:0|[1-9][0-9]*),(?:0|[1-9][0-9]*))$/.exec(window.location.search);null!==e&&s.set("selection",e[1])}t=t.substr("#/".length);let l=t.indexOf("/");-1===l&&(l=t.length);const c=t.substr(0,l),d=t.substr(l+"/".length),_=m.get(c);let f=!1;if(void 0!==_&&(f=_(d,s),f&&n.onPathHandled.emit({handlerId:c})),!f){for(const n of a.redirects){const i=n(t);if(i!==t)return p.log("Redirect matched: ",n,`\nOld page specifier: ${t}\nNew page specifier: ${i}`),void(window.location.hash="#/"+[i,...e.slice(1)].join("~"))}p.log(`${a.redirects.length} possible redirects processed. None matched.`),(0,E.notify)(i.BROKEN_LINK_TITLE,i.BROKEN_LINK_DESC,i.BROKEN_LINK_OK),document.title="晶体图书馆",window.history.replaceState(null,"晶体图书馆",window.location.pathname),followQuery()}}},{"../DebugLogger":9,"../Event":10,"../constant/messages":13,"../constant/redirects":15,"./chapterControl":22,"./menuControl":28,"./mirrorControl":29,"./modalControl":30,"./pageControl":32}],26:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.createHint=void 0;const a=e("../hs");let s=Promise.resolve();n.createHint=function createHint(e,t=2e3){s=s.then((()=>i(this,void 0,void 0,(function*(){const n=(0,a.h)(".hint",e);document.body.appendChild(n),n.style.opacity="0",n.offsetWidth,n.style.removeProperty("opacity"),yield new Promise((e=>setTimeout(e,t))),n.style.opacity="0",yield new Promise((e=>setTimeout(e,500))),n.remove()}))))}},{"../hs":45}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setLayout=n.getCurrentLayout=n.layoutChangeEvent=n.Layout=void 0;const i=e("../DebugLogger"),a=e("../Event");var s;!function(e){e[e.SIDE=0]="SIDE",e[e.MAIN=1]="MAIN",e[e.OFF=2]="OFF"}(s=n.Layout||(n.Layout={}));const l=document.body,c=new i.DebugLogger("Layout");n.layoutChangeEvent=new a.Event,n.layoutChangeEvent.on((({newLayout:e})=>{switch(l.classList.remove("layout-side","layout-main","layout-off"),e){case s.SIDE:l.classList.add("layout-side");break;case s.MAIN:l.classList.add("layout-main");break;case s.OFF:l.classList.add("layout-off")}}));let u=s.OFF;n.getCurrentLayout=function getCurrentLayout(){return u},n.setLayout=function setLayout(e){e!==u&&c.log(`${s[u]} -> ${s[e]}`),u!==e&&(n.layoutChangeEvent.emit({previousLayout:u,newLayout:e}),u=e)}},{"../DebugLogger":9,"../Event":10}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.menuPathHandler=n.handleMainMenu=n.exitMenuMode=n.enterMenuMode=n.mainMenu=void 0;const i=e("../DebugLogger"),a=e("../hs"),s=e("../input/keyboard"),l=e("../menu/MainMenu"),c=e("../util/DOM"),u=e("./followQuery");n.mainMenu=new l.MainMenu("#/menu"),n.mainMenu.show();const d=(0,c.id)("menu-control-path"),E=(0,c.id)("menu-control-back"),_=(0,c.id)("menu-control"),p=(0,c.id)("title-container"),m=new i.DebugLogger("Menu Control"),f=[];function getMenu(e){return-1===e?n.mainMenu:f[e].menu}function getCurrentMenu(){return getMenu(f.length-1)}let C=!0;function enteredMenuMode(){C=!0,document.title="晶体图书馆",p.classList.remove("hidden")}function exitMenuMode(){C=!1,m.log("Exit menu mode"),getCurrentMenu().hide(),_.classList.add("hidden"),p.classList.add("hidden")}function pop(){const{menu:e,pathSpan:t}=f.pop();e.destroy();const n=t.offsetLeft;t.classList.add("exiting"),0!==f.length?(t.style.left=`${n}px`,(0,c.forceReflow)(t),t.style.left=`${n+10}px`):t.classList.add("first"),setTimeout((()=>t.remove()),500)}function popUntil(e){for(f.length>e&&m.log("Pop until",e);f.length>e;)pop();f.length=e}function updateShowingMenuControl(){_.classList.toggle("hidden",0===f.length)}n.enterMenuMode=function enterMenuMode(){m.log("Enter menu mode"),0===f.length?window.location.hash="#":window.location.hash="#/menu/"+f.map((({urlSegment:e})=>e)).join("/"),enteredMenuMode()},n.exitMenuMode=exitMenuMode,n.handleMainMenu=function handleMainMenu(){m.log("Handle main menu"),enteredMenuMode(),popUntil(0),n.mainMenu.show(),updateShowingMenuControl()};n.menuPathHandler=e=>{m.log(`Handle path=${e}`),enteredMenuMode();const t=e.split("/");getCurrentMenu().hide();let n=0;for(;n<f.length&&n<t.length&&f[n].urlSegment===t[n];)n++;for(popUntil(n);n<t.length;n++){const e=t[n],i=getMenu(n-1);if(!i.subMenus.has(e))return!1;const{factory:s,name:l}=i.subMenus.get(e),u=s(),E=(0,a.h)("span",[(0,a.h)("span",">"),(0,a.h)("a.button",{href:u.urlBase},l)]);0!==n?(E.classList.add("pre-entering"),d.append(E),(0,c.forceReflow)(E),E.classList.remove("pre-entering")):d.append(E),f.push({menu:u,pathSpan:E,urlSegment:e})}return getCurrentMenu().show(),updateShowingMenuControl(),f.length>1?E.href=f[f.length-2].menu.urlBase:E.href="#",!0},s.escapeKeyPressEvent.on((()=>{C&&(f.length>1?window.location.hash=f[f.length-2].menu.urlBase:1===f.length&&(window.location.hash=""))})),u.onPathHandled.on((({handlerId:e})=>{"menu"!==e&&exitMenuMode()}));const g=(0,c.id)("navbar-logo").cloneNode(!0);g.id="path-logo",d.prepend((0,a.h)("a",{href:"#"},g))},{"../DebugLogger":9,"../hs":45,"../input/keyboard":48,"../menu/MainMenu":54,"../util/DOM":62,"./followQuery":25}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mirrorLandingHandler=n.showMirrorSitesModal=void 0;const i=e("../$e"),a=e("../constant/messages"),s=e("../constant/mirrorSites"),l=e("../data/hrefs"),c=e("../hs"),u=e("./hintControl"),d=e("./modalControl"),E=e("./userControl");function showMirrorSitesModal(e){const t=new d.Modal((0,c.h)(".mirror-site-modal",[(0,c.h)("h1",a.MIRROR_TITLE),(0,c.h)("p",E.tokenItem.exists()?a.MIRROR_DESC_0:a.MIRROR_DESC_0_NO_TOKEN),(0,c.h)("p",a.MIRROR_DESC_1),(0,c.h)(".button-container",[...s.mirrorSitesPlusMainSite.map((({name:e,origin:n,provider:s,technology:u})=>{const d=(0,c.h)("a.rich",{href:n===window.location.origin?"#":(0,l.mirrorLandingHref)(n,E.tokenItem.getValue()),onclick:e=>{e.preventDefault(),n!==window.location.origin&&window.location.replace((0,l.mirrorLandingHref)(n,E.tokenItem.getValue(),t.modal.scrollTop))}},[(0,c.h)("h2",e),(0,c.h)("p",[...n.startsWith("http://")?[(0,i.$e)("span",{className:"http-warning"},"本镜像站未加密（使用 HTTP），非紧急情况请避免使用！"),(0,i.$e)("br",null)]:[],a.MIRROR_URL+n,(0,c.h)("br"),a.MIRROR_PROVIDED_BY+s,(0,c.h)("br"),a.MIRROR_TECHNOLOGY+u])]);return n===window.location.origin&&d.classList.add("selected"),d})),(0,c.h)("div",{onclick:()=>t.close()},a.GENERIC_CLOSE)])]));t.setDismissible(),t.open(),void 0!==e&&(t.modal.scrollTop=e)}n.showMirrorSitesModal=showMirrorSitesModal;n.mirrorLandingHandler=(e,t)=>{window.history.replaceState(null,document.title,"#/mirror-landing"),window.location.hash="#",showMirrorSitesModal(t.has("scroll")?+t.get("scroll"):void 0);const n=t.get("token");if(void 0===n)return!0;if(!s.mirrorSitesPlusMainSite.some((e=>document.referrer===e.origin||document.referrer.startsWith(e.origin+"/"))))return(0,d.showGenericError)(a.MIRROR_LANDING_INVALID_REFERRAL),!0;const i=E.tokenItem.getValue();return null!==i?i!==n&&(0,d.confirm)(a.MIRROR_LANDING_CONFLICT_TITLE,a.MIRROR_LANDING_CONFLICT_DESC,a.MIRROR_LANDING_CONFLICT_OVERWRITE,a.MIRROR_LANDING_CONFLICT_KEEP).then((e=>{e&&(E.tokenItem.setValue(n),(0,u.createHint)(a.MIRROR_LANDING_SUCCESS_HINT))})):(E.tokenItem.setValue(n),(0,u.createHint)(a.MIRROR_LANDING_SUCCESS_HINT)),!0}},{"../$e":8,"../constant/messages":13,"../constant/mirrorSites":14,"../data/hrefs":42,"../hs":45,"./hintControl":26,"./modalControl":30,"./userControl":38}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isAnyModalOpened=n.showGenericLoading=n.showGenericHint=n.showGenericError=n.showGenericSuccess=n.notify=n.confirm=n.Modal=void 0;const i=e("../constant/messages"),a=e("../data/settings"),s=e("../hs"),l=e("../input/keyboard"),c=e("../util/DOM"),u=(0,c.id)("modal-holder");class Modal{constructor(e=(0,s.h)("div")){this.dismissSet=!1,this.escKeyListener=null,e.classList.add("modal"),this.modal=e,this.modalContainer=(0,s.h)(".modal-container.closed",e),u.appendChild(this.modalContainer)}open(){(0,c.forceReflow)(this.modalContainer),this.modalContainer.classList.remove("closed")}close(){a.animation.getValue()?(this.modalContainer.classList.add("closed"),setTimeout((()=>{this.modalContainer.remove()}),400)):this.modalContainer.remove(),null!==this.escKeyListener&&l.escapeKeyPressEvent.off(this.escKeyListener)}setDismissible(e=(()=>{this.close()})){if(this.dismissSet)throw new Error("Dismissible already set.");this.dismissSet=!0,l.escapeKeyPressEvent.on(e),this.modalContainer.addEventListener("click",(t=>{t.target===this.modalContainer&&e()}))}}function notify(e,t,n){let i=!1;return new Promise((a=>{const l=new Modal((0,s.h)("div",[(0,s.h)("h1",e),""===t?null:(0,s.h)("p",t),(0,s.h)(".button-container",[(0,s.h)("div",{onclick:()=>{i||(i=!0,l.close(),a())}},n)])]));l.open()}))}n.Modal=Modal,n.confirm=function confirm(e,t,n,i){let a=!1;return new Promise((l=>{const c=new Modal((0,s.h)("div",[(0,s.h)("h1",e),""===t?null:(0,s.h)("p",t),(0,s.h)(".button-container",[(0,s.h)("div",{onclick:()=>{a||(a=!0,c.close(),l(!0))}},n),(0,s.h)("div",{onclick:()=>{a||(a=!0,c.close(),l(!1))}},i)])]));c.open()}))},n.notify=notify,n.showGenericSuccess=function showGenericSuccess(e){return notify(i.GENERIC_SUCCESS_TITLE,null!=e?e:i.GENERIC_SUCCESS_DESC,i.GENERIC_CONFIRM)},n.showGenericError=function showGenericError(e){return notify(i.GENERIC_ERROR_TITLE,null!=e?e:i.GENERIC_ERROR_DESC,i.GENERIC_CONFIRM)},n.showGenericHint=function showGenericHint(e){return notify(i.GENERIC_HINT_TITLE,e,i.GENERIC_CONFIRM)},n.showGenericLoading=function showGenericLoading(e){const t=new Modal((0,s.h)("div",[(0,s.h)("h1",i.GENERIC_LOADING_TITLE),(0,s.h)("p",null!=e?e:i.GENERIC_LOADING_DESC)]));return t.open(),t},n.isAnyModalOpened=function isAnyModalOpened(){return u.childElementCount>0}},{"../constant/messages":13,"../data/settings":44,"../hs":45,"../input/keyboard":48,"../util/DOM":62}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setNavbarPath=n.resetProgressIndicator=n.setProgressIndicator=void 0;const i=e("../data/settings"),a=e("../hs"),s=e("../util/DOM"),l=e("./contentControl"),c=e("./layoutControl"),u=e("./menuControl"),d=(0,s.id)("navbar"),E=(0,s.id)("navbar-path-container"),_=(0,s.id)("navbar-progress-indicator"),p=(0,s.id)("navbar-logo"),m=(0,s.id)("navbar-title");let f;function setProgressIndicator(e){_.style.transform=`scaleX(${e})`,_.classList.toggle("hidden",1===e||0===e)}function resetProgressIndicator(){setProgressIndicator(0)}n.setProgressIndicator=setProgressIndicator,n.resetProgressIndicator=resetProgressIndicator,c.layoutChangeEvent.on((({newLayout:e})=>{resetProgressIndicator(),setTimeout((()=>f=e),100)})),p.addEventListener("click",(()=>{(0,u.enterMenuMode)()})),m.addEventListener("click",(e=>{e.preventDefault(),(0,u.enterMenuMode)()})),l.contentScrollEvent.on((({scrollTop:e})=>d.classList.toggle("flat",e<50))),l.contentChangeEvent.on((()=>d.classList.add("flat")));const C=[];function removeElement(e){i.animation.getValue()&&f===c.Layout.MAIN?(e.style.left=`${e.offsetLeft}px`,e.classList.add("exiting"),setTimeout((()=>{e.remove()}),500)):e.remove()}function createNavbarPathSegment(e){const t=(0,a.h)(".arrow",">"),n=null===e.hash?(0,a.h)(".anchor",e.display):(0,a.h)("a.button.anchor",{href:e.hash},e.display);return E.appendChild(t),E.appendChild(n),i.animation.getValue()&&f===c.Layout.MAIN&&(t.classList.add("entering"),n.classList.add("entering"),(0,s.forceReflow)(n),t.classList.remove("entering"),n.classList.remove("entering")),Object.assign({$arrow:t,$anchor:n},e)}n.setNavbarPath=function setNavbarPath(e){let t=0;for(;C.length>t&&e.length>t&&(n=C[t],i=e[t],n.display===i.display&&n.hash===i.hash);)t++;var n,i,a;for(let e=C.length-1;e>=t;e--)removeElement((a=C[e]).$anchor),removeElement(a.$arrow);C.length=t;for(let n=t;n<e.length;n++)C.push(createNavbarPathSegment(e[n]))}},{"../data/settings":44,"../hs":45,"../util/DOM":62,"./contentControl":24,"./layoutControl":27,"./menuControl":28}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.pagePathHandler=void 0;const i=e("../input/keyboard"),a=e("../pages/author"),s=e("../pages/taggingTool"),l=e("../pages/tagSearch"),c=e("../pages/visitCount"),u=e("./contentControl"),d=e("./layoutControl"),E=e("./menuControl"),_=[c.visitCount,a.author,s.taggingTool,l.tagSearch];class PagePath{constructor(e,t){this.current=e,this.prefix=t}get(){return this.current}set(e){this.current=e,window.history.replaceState(null,document.title,this.prefix+e)}}n.pagePathHandler=e=>{for(const t of _)if(e===t.name||e.startsWith(t.name+"/")){const n=(0,u.newContent)(u.Side.RIGHT);i.escapeKeyPressEvent.onceUntil(E.enterMenuMode,n.leavingEvent),(0,d.setLayout)(d.Layout.MAIN);return t.handler(n,new PagePath(e.substr(t.name.length+1),`#/page/${t.name}/`))}return!1}},{"../input/keyboard":48,"../pages/author":58,"../pages/tagSearch":59,"../pages/taggingTool":60,"../pages/visitCount":61,"./contentControl":24,"./layoutControl":27,"./menuControl":28}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NumberPersistentItem=n.StringPersistentItem=n.PersistentItem=void 0;class PersistentItem{constructor(e,t,n){this.key=e,this.serializer=t,this.deserializer=n}getValue(){const e=window.localStorage.getItem(this.key);return null===e?null:this.deserializer(e)}setValue(e){window.localStorage.setItem(this.key,this.serializer(e))}remove(){window.localStorage.removeItem(this.key)}setValueNullable(e){null===e?this.remove():this.setValue(e)}exists(){return null!==this.getValue()}}n.PersistentItem=PersistentItem;const identity=e=>e;n.StringPersistentItem=class StringPersistentItem extends PersistentItem{constructor(e){super(e,identity,identity)}};const numberToString=e=>String(e),stringToNumber=e=>{const t=+e;return Number.isNaN(t)?null:t};n.NumberPersistentItem=class NumberPersistentItem extends PersistentItem{constructor(e){super(e,numberToString,stringToNumber)}}},{}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.addPreloaderBlock=void 0;const i=e("../$e"),a=e("../util/array"),s=e("../util/math");function getLine(e){const t=100===e?{}:{clipPath:`inset(0 ${100-e}% 0 0)`};return(0,i.$e)("div",{className:"flash-container",style:t},(0,i.$e)("div",{className:"flash"}))}function getFullLine(){return getLine(100)}function getPartialLine(){return getLine(60*Math.random()+20)}n.addPreloaderBlock=function addPreloaderBlock(e){return e.addBlock({initElement:(0,i.$e)("div",{className:"preloader"},(0,i.$e)("div",{className:"preloader-title"},getPartialLine()),(0,a.produce)(12,(()=>(0,i.$e)("div",{className:"preloader-paragraph"},(0,a.produce)((0,s.randomInt)(1,5),getFullLine),getPartialLine()))))})}},{"../$e":8,"../util/array":63,"../util/math":67}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.processElements=void 0;const i=e("../util/DOM");n.processElements=function processElements(e){Array.from(e.getElementsByTagName("a")).forEach((e=>{const t=e.attributes.getNamedItem("href");null===t||t.value.startsWith("#")||(e.target="_blank"),e.rel="noopener noreferrer",e.className="regular"})),Array.from(e.getElementsByTagName("code")).forEach((e=>e.addEventListener("dblclick",(()=>{e.parentNode instanceof HTMLPreElement||(0,i.selectNode)(e)})))),Array.from(e.getElementsByTagName("img")).forEach((e=>{const t=e.src.replace(/\.([^.]+)$/,".full.$1");e.style.cursor="zoom-in",e.addEventListener("click",(()=>window.open(t)))}))}},{"../util/DOM":62}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.addPushHelperBlock=void 0;const i=e("../$e"),a=e("../data/settings"),s=e("./contentControl"),l=e("./modalControl");n.addPushHelperBlock=function addPushHelperBlock(e,t){a.enablePushHelper.getValue()&&e.addBlock({initElement:(0,i.$e)("div",null,(0,i.$e)("h3",null,"推送助手"),(0,i.$e)("div",{className:"button-container"},(0,i.$e)("div",{onclick:()=>{!function openPushHelper(e){var t,n;const a=[...new Set(null!==(n=null===(t=e.tags)||void 0===t?void 0:t.map((e=>`#${e.split("（")[0]}`)))&&void 0!==n?n:[])],s=new l.Modal((0,i.$e)("div",null,(0,i.$e)("h1",null,"推送助手"),(0,i.$e)("p",null,"字数：",e.charsCount),(0,i.$e)("p",null,"标签："),(0,i.$e)("pre",{className:"wrapping"},(0,i.$e)("code",null,a.join(" "))),(0,i.$e)("div",{className:"button-container"},(0,i.$e)("div",{onclick:()=>s.close()},"关闭"))));s.setDismissible(),s.open()}(t)}},"打开推送助手")),(0,i.$e)("p",null,"推送助手是给《可穿戴科技》的编辑们使用的工具。如果你不是《可穿戴科技》的编辑，你可以前往设置并禁用推送助手。")),side:s.ContentBlockSide.LEFT})}},{"../$e":8,"../data/settings":44,"./contentControl":24,"./modalControl":30}],37:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.search=void 0;const a=e("../data/data");function matchTag(e,t){if(e.includes(t))return t;if(t.includes("（"))return null;for(const n of e)if(n.startsWith(t+"（"))return n;return null}n.search=function search(e){return i(this,void 0,void 0,(function*(){let t=Date.now();const n=[];e:for(const{chapter:i}of a.relativePathLookUpMap.values()){if(Date.now()-t>10&&(yield new Promise((e=>setTimeout(e,1))),t=Date.now()),void 0===i.tags)continue;let a=0;const s=[];for(const{searchTag:t,type:n}of e){const e=matchTag(i.tags,t);if("excluded"===n){if(null!==e)continue e;a++}else if("required"===n){if(null===e)continue e;a++,s.push(e)}else"favored"===n&&null!==e&&(a++,s.push(e))}a>0&&n.push({score:a,chapter:i,matchedTags:s})}return n.sort(((e,t)=>e.score!==t.score?t.score-e.score:t.chapter.creationTime-e.chapter.creationTime)),n}))}},{"../data/data":40}],38:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.showUpdateProfileModal=n.showLoginModal=n.init=n.removeNewMentionLink=n.getCurrentUser=n.registerWithResultPopup=n.tokenItem=void 0;const a=e("../constant/messages"),s=e("../data/hrefs"),l=e("../DebugLogger"),c=e("../hs"),u=e("../Menu"),d=e("../util/DOM"),E=e("./backendControl"),_=e("./menuControl"),p=e("./modalControl"),m=e("./persistentItem"),f=new l.DebugLogger("User Control");n.tokenItem=new m.StringPersistentItem("token");let C=null;n.registerWithResultPopup=function registerWithResultPopup(e,t){return i(this,void 0,void 0,(function*(){let i;try{i=yield(0,E.fetchRegister)(e,null!=t?t:void 0)}catch(e){return(0,p.showGenericError)(a.GENERIC_INTERNET_ERROR),f.error(e),!1}return i.success?(n.tokenItem.setValue(i.token),C={displayName:e,userName:i.user_name,email:t},!0):((0,p.showGenericError)((0,E.getErrorMessage)(i.code)),!1)}))},n.getCurrentUser=function getCurrentUser(){return C};let g=null;function removeNewMentionLink(){null!==g&&(g.remove(),g=null)}var T;function init(e){var t;return i(this,void 0,void 0,(function*(){let i;f.log("Initializing."),removeNewMentionLink();try{i=yield(0,E.fetchInit)(e)}catch(e){return f.warn("Initialization failed: ",e),T.ERROR_NETWORK}return i.success?(n.tokenItem.setValue(e),C={displayName:i.display_name,email:null!==(t=i.email)&&void 0!==t?t:null,userName:i.user_name},f.log(`Initialization result: ${i.mentions} new mentions.`),0!==i.mentions&&(g=_.mainMenu.addItem(`您有 ${i.mentions} 条新回复`,{button:!0,link:(0,s.pageHref)("recent-mentions"),decoration:u.ItemDecoration.ICON_NOTIFICATION,location:u.ItemLocation.BEFORE}),g.addClass("force-small")),T.SUCCESS):(f.warn("Initialization failed: Invalid token."),T.ERROR_TOKEN)}))}n.removeNewMentionLink=removeNewMentionLink,function(e){e[e.SUCCESS=0]="SUCCESS",e[e.ERROR_NETWORK=1]="ERROR_NETWORK",e[e.ERROR_TOKEN=2]="ERROR_TOKEN"}(T||(T={})),n.init=init,n.showLoginModal=function showLoginModal(){var e;const t=null!==(e=n.tokenItem.getValue())&&void 0!==e?e:"",i=(0,c.h)("input",{value:t}),s=(0,c.h)("div.display-none",{onclick:()=>{if(""===i.value)return void(0,p.showGenericError)(a.USER_TOKEN_CHANGE_EMPTY);const e=(0,p.showGenericLoading)(a.USER_TOKEN_CHANGE_CHECKING);f.log("Changing token..."),init(i.value).then((e=>{e===T.SUCCESS?(f.log("Change token successful."),(0,p.showGenericSuccess)(a.USER_TOKEN_CHANGE_SUCCESS).then((()=>{u.close()}))):e===T.ERROR_NETWORK?(0,p.showGenericError)(a.GENERIC_INTERNET_ERROR):(0,p.showGenericError)(a.USER_TOKEN_CHANGE_INVALID)})).finally((()=>{e.close()}))}},a.GENERIC_CONFIRM),l=(0,c.h)("div",{onclick:()=>{u.close()}},a.GENERIC_CLOSE);i.addEventListener("input",(()=>{i.value===t?(s.classList.add("display-none"),l.innerText=a.GENERIC_CLOSE):(s.classList.remove("display-none"),l.innerText=a.GENERIC_CANCEL)}));const u=new p.Modal((0,c.h)("div",[(0,c.h)("h1",a.USER_TOKEN_CHANGE_TITLE),...a.USER_TOKEN_CHANGE_DESC.split("\n").map((e=>(0,c.h)("p",e))),(0,c.h)(".input-group",[(0,c.h)("span",a.USER_TOKEN_CHANGE_INPUT_LABEL),i]),(0,c.h)(".button-container",[s,l])]));u.open()},n.showUpdateProfileModal=function showUpdateProfileModal(){return new Promise((e=>{var t;if(!n.tokenItem.exists())return void(0,p.showGenericHint)(a.USER_TOKEN_DOES_NOT_EXIST);const i=C;if(null===i)return(0,p.showGenericError)(a.USER_UPDATE_PROFILE_ERROR_NOT_INITIALIZED),void console.error(1);const s=(0,c.h)("input",{value:i.displayName}),l=(0,c.h)("input",{value:null!==(t=i.email)&&void 0!==t?t:""}),u=new p.Modal((0,c.h)("div",[(0,c.h)("h1",a.USER_UPDATE_PROFILE_TITLE),...a.USER_UPDATE_PROFILE_DESC.split("\n").map((e=>(0,c.h)("p",e))),(0,c.h)("ul",[(0,c.h)("li",a.USER_UPDATE_PROFILE_HINT_USER_NAME),(0,c.h)("li",a.USER_UPDATE_PROFILE_HINT_DISPLAY_NAME),(0,c.h)("li",[a.USER_UPDATE_PROFILE_HINT_EMAIL_0,(0,d.externalLink)(a.USER_UPDATE_PROFILE_HINT_EMAIL_GRAVATAR_LINK,"https://cn.gravatar.com/"),a.USER_UPDATE_PROFILE_HINT_EMAIL_1])]),(0,c.h)(".input-group",[(0,c.h)("span",a.USER_UPDATE_PROFILE_USER_NAME_INPUT_LABEL+"@"+i.userName)]),(0,c.h)(".input-group",[(0,c.h)("span",a.USER_UPDATE_PROFILE_DISPLAY_NAME_INPUT_LABEL),s]),(0,c.h)(".input-group",[(0,c.h)("span",a.USER_UPDATE_PROFILE_EMAIL_INPUT_LABEL),l]),(0,c.h)(".button-container",[(0,c.h)("div",{onclick:()=>{if(""===s.value)return void(0,p.showGenericError)(a.USER_UPDATE_PROFILE_DISPLAY_NAME_EMPTY);const t=(0,p.showGenericLoading)(a.USER_UPDATE_PROFILE_LOADING);f.log("Updating profile...");const c=s.value,d=""===l.value?void 0:l.value;(0,E.fetchUpdateProfile)(n.tokenItem.getValue(),c,d).then((t=>{t.success?((0,p.showGenericSuccess)(a.USER_UPDATE_PROFILE_SUCCESS).then((()=>{u.close(),e()})),i.displayName=c,i.email=null!=d?d:null,f.log("Update profile success")):(f.warn("Update profile failed, error code:",t.code,", translated:",(0,E.getErrorMessage)(t.code)),(0,p.showGenericError)((0,E.getErrorMessage)(t.code)))}),(e=>{(0,p.showGenericError)(a.GENERIC_INTERNET_ERROR),f.error("Update profile failed:",e)})).finally((()=>{t.close()}))}},a.GENERIC_CONFIRM),(0,c.h)("div",{onclick:()=>{u.close(),e()}},a.GENERIC_CANCEL)])]));u.open()}))}},{"../DebugLogger":9,"../Menu":11,"../constant/messages":13,"../data/hrefs":42,"../hs":45,"../util/DOM":62,"./backendControl":21,"./menuControl":28,"./modalControl":30,"./persistentItem":33}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AutoSingleCache=n.AutoCache=void 0;class AutoCache{constructor(e,t){this.loader=e,this.logger=t,this.map=new Map}delete(e){this.map.delete(e)}get(e){let t=this.map.get(e);return void 0===t?(this.logger.log(`Start loading for key=${e}.`),t=this.loader(e),this.map.set(e,t),t.catch((t=>{this.map.delete(e),this.logger.warn(`Loader failed for key=${e}. Cache removed.`,t)}))):this.logger.log(`Cached value used for key=${e}.`),t}}n.AutoCache=AutoCache;n.AutoSingleCache=class AutoSingleCache extends AutoCache{constructor(e,t){super(e,t)}delete(){super.delete(null)}get(){return super.get(null)}}},{}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tagAliasMap=n.authorInfoMap=n.relativePathLookUpMap=n.tagCountMap=n.data=void 0;const i=e("../DebugLogger");n.data=window.DATA;const a=new i.DebugLogger("Data");function incrementCount(e){var t;n.tagCountMap.set(e,(null!==(t=n.tagCountMap.get(e))&&void 0!==t?t:0)+1)}n.tagCountMap=new Map,n.relativePathLookUpMap=new Map;const s=Date.now();!function iterateFolder(e){e.children.forEach(((t,i)=>{var a;"folder"===t.type?iterateFolder(t):(n.relativePathLookUpMap.set(t.htmlRelativePath,{folder:e,chapter:t,inFolderIndex:i}),null===(a=t.tags)||void 0===a||a.forEach((e=>{incrementCount(e),e.includes("（")&&incrementCount(e.substr(0,e.indexOf("（")))})))}))}(n.data.chapterTree),a.log(`Iterating folders took ${Date.now()-s}ms.`),n.authorInfoMap=new Map;for(const e of n.data.authorsInfo)n.authorInfoMap.set(e.name,e);n.tagAliasMap=new Map(n.data.tagAliases)},{"../DebugLogger":9}],41:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.getDb=n.dbKVGet=n.dbKVSet=n.dbKVKey=n.untilSuccess=void 0;const a=e("../DebugLogger");let s=null;const l=new a.DebugLogger("IndexedDB"),c=new Map([[0,e=>{e.createObjectStore("readingProgress",{keyPath:"relativePath"}).createIndex("lastRead","lastRead")}],[1,e=>{e.createObjectStore("simpleKV")}]]);function untilSuccess(e){return new Promise((t=>{e.onsuccess=function(){t(this.result)}}))}function getDb(){return null===s&&(s=new Promise(((e,t)=>{l.log("Open database");const n=window.indexedDB.open("main",2);n.onsuccess=()=>{l.log("Database successfully opened."),e(n.result)},n.onerror=()=>{l.error("Database failed to open: ",n.error),t(n.error)},n.onupgradeneeded=e=>{l.log(`Migrating from ${e.oldVersion} to ${e.newVersion}`);const t=n.result;for(let n=e.oldVersion;n<e.newVersion;n++){const e=c.get(n);if(void 0===e)throw new Error(`Missing migration for version=${n}.`);l.log(`Running migration ${n} -> ${n+1}`),e(t)}l.log("Migration completed")}}))),s}n.untilSuccess=untilSuccess,n.dbKVKey=function dbKVKey(e){return{key:e}},n.dbKVSet=function dbKVSet(e,t){return i(this,void 0,void 0,(function*(){const n=(yield getDb()).transaction("simpleKV","readwrite").objectStore("simpleKV");yield untilSuccess(n.put(t,e.key))}))},n.dbKVGet=function dbKVGet(e){var t;return i(this,void 0,void 0,(function*(){const n=(yield getDb()).transaction("simpleKV","readwrite").objectStore("simpleKV");return null!==(t=yield untilSuccess(n.get(e.key)))&&void 0!==t?t:null}))},n.getDb=getDb},{"../DebugLogger":9}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tagSearchHref=n.mirrorLandingHref=n.pageHref=n.chapterHref=void 0,n.chapterHref=function chapterHref(e){return`#/chapter/${e}`},n.pageHref=function pageHref(e){return`#/page/${e}`},n.mirrorLandingHref=function mirrorLandingHref(e,t,n){let i=`${e}/#/mirror-landing`;return null!==t&&(i+=`~token=${t}`),void 0!==n&&(i+=`~scroll=${n}`),i},n.tagSearchHref=function tagSearchHref(e){return`#/page/tag-search/${e}`}},{}],43:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.getHistory=n.updateChapterProgress=void 0;const a=e("./db");n.updateChapterProgress=function updateChapterProgress(e,t){var n;return i(this,void 0,void 0,(function*(){const s=yield function getStore(){return i(this,void 0,void 0,(function*(){return(yield(0,a.getDb)()).transaction("readingProgress","readwrite").objectStore("readingProgress")}))}(),l=yield(0,a.untilSuccess)(s.get(e));yield(0,a.untilSuccess)(s.put({relativePath:e,lastRead:new Date,progress:Math.max(t,null!==(n=null==l?void 0:l.progress)&&void 0!==n?n:0)}))}))},n.getHistory=function getHistory(e=20){return i(this,void 0,void 0,(function*(){const t=(yield function getReadonlyStore(){return i(this,void 0,void 0,(function*(){return(yield(0,a.getDb)()).transaction("readingProgress").objectStore("readingProgress")}))}()).index("lastRead");return new Promise((n=>{const i=[];t.openCursor(null,"prev").onsuccess=function(){const t=this.result;null!==t?(i.push(t.value),i.length>=e?n(i):t.continue()):n(i)}}))}))}},{"./db":41}],44:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.lite=n.chapterRecommendationCount=n.enablePushHelper=n.showAbandonedChapters=n.wtcdGameQuickLoadConfirm=n.charCount=n.developerMode=n.fontFamily=n.gestureSwitchChapter=n.useComments=n.earlyAccess=n.warning=n.animation=n.EnumSetting=n.BooleanSetting=void 0;const i=e("../Event"),noop=()=>{};class BooleanSetting{constructor(e,n){this.key=e,this.event=new i.Event,this.value=n?"false"!==window.localStorage.getItem(e):"true"===window.localStorage.getItem(e),this.updateLocalStorage(),t((()=>this.event.emit(this.value)))}updateLocalStorage(){window.localStorage.setItem(this.key,String(this.value))}getValue(){return this.value}setValue(e){e!==this.value&&this.event.emit(e),this.value=e,this.updateLocalStorage()}toggle(){this.setValue(!this.value)}}n.BooleanSetting=BooleanSetting;class EnumSetting{constructor(e,t,n,i=noop){if(this.key=e,this.options=t,this.defaultValue=n,this.onUpdate=i,!this.isCorrectValue(n))throw new Error(`Default value ${n} is not correct.`);this.value=+(window.localStorage.getItem(e)||n),this.correctValue(),this.onUpdate(this.value,this.options[this.value])}isCorrectValue(e){return!(Number.isNaN(e)||e%1!=0||e<0||e>=this.options.length)}correctValue(){this.isCorrectValue(this.value)||(this.value=this.defaultValue)}updateLocalStorage(){window.localStorage.setItem(this.key,String(this.value))}getValue(){return this.value}getValueName(){return this.options[this.value]}setValue(e){e!==this.value&&this.onUpdate(e,this.options[e]),this.value=e,this.updateLocalStorage()}}n.EnumSetting=EnumSetting,n.animation=new BooleanSetting("animation",!0),n.animation.event.on((e=>{setTimeout((()=>{document.body.classList.toggle("animation-enabled",e)}),1)})),n.warning=new BooleanSetting("warning",!1),n.earlyAccess=new BooleanSetting("earlyAccess",!1),n.useComments=new BooleanSetting("useComments",!0),n.gestureSwitchChapter=new BooleanSetting("gestureSwitchChapter",!0);const a=['-apple-system, "Noto Sans", "Helvetica Neue", Helvetica, "Nimbus Sans L", Arial, "Liberation Sans", "PingFang SC", "Hiragino Sans GB", "Noto Sans CJK SC", "Source Han Sans SC", "Source Han Sans CN", "Microsoft YaHei", "Wenquanyi Micro Hei", "WenQuanYi Zen Hei", "ST Heiti", SimHei, "WenQuanYi Zen Hei Sharp", sans-serif','Baskerville, Georgia, "Liberation Serif", "Kaiti SC", STKaiti, "AR PL UKai CN", "AR PL UKai HK", "AR PL UKai TW", "AR PL UKai TW MBE", "AR PL KaitiM GB", KaiTi, KaiTi_GB2312, DFKai-SB, "TW-Kai", serif','Georgia, "Nimbus Roman No9 L", "Songti SC", "Noto Serif CJK SC", "Source Han Serif SC", "Source Han Serif CN", STSong, "AR PL New Sung", "AR PL SungtiL GB", NSimSun, SimSun, "TW-Sung", "WenQuanYi Bitmap Song", "AR PL UMing CN", "AR PL UMing HK", "AR PL UMing TW", "AR PL UMing TW MBE", PMingLiU, MingLiU, serif','Baskerville, "Times New Roman", "Liberation Serif", STFangsong, FangSong, FangSong_GB2312, "CWTEX-F", serif'];n.fontFamily=new EnumSetting("fontFamily",["黑体","楷体","宋体","仿宋"],0,(e=>{document.documentElement.style.setProperty("--font-family",a[e]),document.documentElement.style.setProperty("--font-family-mono",'"Fira Code", '+a[e])})),n.developerMode=new BooleanSetting("developerMode",!1),n.charCount=new BooleanSetting("charCount",!0),n.wtcdGameQuickLoadConfirm=new BooleanSetting("wtcdGameQuickLoadConfirm",!0),n.showAbandonedChapters=new BooleanSetting("showAbandonedChapters",!1),n.enablePushHelper=new BooleanSetting("enablePushHelper",!1),n.chapterRecommendationCount=new EnumSetting("chapterRecommendationCount",["禁用","5 条","10 条","15 条","20 条","25 条","30 条","35 条","40 条","45 条","50 条"],2),n.lite=new BooleanSetting("lite",!1)}).call(this)}).call(this,e("timers").setImmediate)},{"../Event":10,timers:7}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.h=void 0;const i=e("hyperscript");n.h=i},{hyperscript:4}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("./constant/messages");e("./control/analyticsControl");const a=e("./control/followQuery"),s=e("./control/modalControl");e("./control/navbarControl");const l=e("./control/userControl"),c=e("./data/data"),u=e("./data/settings"),d=e("./util/DOM"),E=(0,d.id)("warning");null!==E&&E.addEventListener("click",(()=>{E.style.opacity="0",u.animation.getValue()?E.addEventListener("transitionend",(()=>{E.remove()})):E.remove()}));(0,d.id)("build-number").innerText=`Build ${c.data.buildNumber}`,l.tokenItem.exists()&&(0,l.init)(l.tokenItem.getValue()),c.data.buildError&&(0,s.notify)(i.BUILD_FAILED_TITLE,i.BUILD_FAILED_DESC,i.BUILD_FAILED_OK),(0,a.initPathHandlers)(),window.addEventListener("popstate",(()=>{(0,a.followQuery)()})),(0,a.followQuery)()},{"./constant/messages":13,"./control/analyticsControl":20,"./control/followQuery":25,"./control/modalControl":30,"./control/navbarControl":31,"./control/userControl":38,"./data/data":40,"./data/settings":44,"./util/DOM":62}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.swipeEvent=n.SwipeDirection=void 0;const i=e("../DebugLogger"),a=e("../Event"),s=e("../util/DOM");var l;!function(e){e[e.TO_TOP=0]="TO_TOP",e[e.TO_RIGHT=1]="TO_RIGHT",e[e.TO_BOTTOM=2]="TO_BOTTOM",e[e.TO_LEFT=3]="TO_LEFT"}(l=n.SwipeDirection||(n.SwipeDirection={}));n.swipeEvent=new a.Event;let c=0,u=0,d=0,E=null;window.addEventListener("touchstart",(e=>{1===e.touches.length&&(E=e.target,c=e.touches[0].clientX,u=e.touches[0].clientY,d=Date.now())})),window.addEventListener("touchend",(e=>{if(0!==e.touches.length)return;if(Date.now()-d>500)return;if(window.innerWidth>900)return;const t=e.changedTouches[0].clientX-c,i=e.changedTouches[0].clientY-u,a=Math.abs(t/window.innerWidth),_=Math.abs(i/window.innerHeight);if(a>.17&&_<.1){if((0,s.isAnyParent)(E,(e=>"hidden"!==window.getComputedStyle(e).getPropertyValue("overflow-x")&&e.scrollWidth>e.clientWidth)))return;t>0?n.swipeEvent.emit(l.TO_RIGHT):n.swipeEvent.emit(l.TO_LEFT)}else if(_>.1&&a<.1){if((0,s.isAnyParent)(E,(e=>"hidden"!==window.getComputedStyle(e).getPropertyValue("overflow-y")&&e.scrollHeight>e.clientHeight)))return;i>0?n.swipeEvent.emit(l.TO_BOTTOM):n.swipeEvent.emit(l.TO_TOP)}}));const _=new i.DebugLogger("Swipe Event");n.swipeEvent.on((e=>{_.log(l[e])}))},{"../DebugLogger":9,"../Event":10,"../util/DOM":62}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.escapeKeyPressEvent=n.arrowKeyPressEvent=n.ArrowKey=void 0;const i=e("../DebugLogger"),a=e("../Event");var s;!function(e){e[e.LEFT=0]="LEFT",e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.DOWN=3]="DOWN"}(s=n.ArrowKey||(n.ArrowKey={})),n.arrowKeyPressEvent=new a.Event,n.escapeKeyPressEvent=new a.Event,document.addEventListener("keydown",(e=>{if(!e.repeat)switch(e.keyCode){case 27:n.escapeKeyPressEvent.emit();break;case 37:n.arrowKeyPressEvent.emit(s.LEFT);break;case 38:n.arrowKeyPressEvent.emit(s.UP);break;case 39:n.arrowKeyPressEvent.emit(s.RIGHT);break;case 40:n.arrowKeyPressEvent.emit(s.DOWN)}}));const l=new i.DebugLogger("Arrow Key Event");n.arrowKeyPressEvent.on((e=>{l.log(s[e])}))},{"../DebugLogger":9,"../Event":10}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AuthorsMenu=void 0;const i=e("../Menu"),a=e("../data/data"),s=e("../data/hrefs"),l=e("../util/shortNumber");class AuthorsMenu extends i.Menu{constructor(e){super(e);const t=new Map;Array.from(a.relativePathLookUpMap.values()).forEach((e=>{var n;const i=null!==(n=e.chapter.charsCount)&&void 0!==n?n:1;e.chapter.authors.forEach((({name:e})=>{t.has(e)?t.set(e,t.get(e)+i):t.set(e,i)}))})),Array.from(t).sort(((e,t)=>t[1]-e[1])).forEach((([e,t])=>{this.addItem(e,{button:!0,decoration:i.ItemDecoration.ICON_PERSON,link:(0,s.pageHref)(`author/${e}`)}).append(`[${(0,l.shortNumber)(t)}]`)}))}}n.AuthorsMenu=AuthorsMenu},{"../Menu":11,"../data/data":40,"../data/hrefs":42,"../util/shortNumber":69}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ChapterListingMenu=n.isAbandonedFolder=n.isEmptyFolder=void 0;const i=e("../control/chapterControl"),a=e("../data/data"),s=e("../data/hrefs"),l=e("../data/settings"),c=e("../Menu"),u=e("../util/shortNumber"),d=e("./ChaptersMenu");function isEmptyFolder(e){return e.children.every((e=>"folder"===e.type?isEmptyFolder(e):!(0,i.canChapterShown)(e)))}function isAbandonedFolder(e){return e.children.every((e=>"folder"===e.type?isAbandonedFolder(e):e.abandoned))}n.isEmptyFolder=isEmptyFolder,n.isAbandonedFolder=isAbandonedFolder;class ChapterListingMenu extends c.Menu{constructor(e,t){super(e),void 0===t&&(t=a.data.chapterTree);for(const e of t.children)if("folder"===e.type){const t=this.buildSubMenu(e.displayName,ChapterListingMenu,e).setUrlSegment(e.displayName.replace(/ /g,"-")).setDecoration(c.ItemDecoration.ICON_FOLDER).setHidden(isEmptyFolder(e)).build();isAbandonedFolder(e)&&t.prepend("[已弃坑]"),null!==e.charsCount&&l.charCount.getValue()&&t.append(`[${(0,u.shortNumber)(e.charsCount)}]`)}else{if(e.hidden)continue;if(e.abandoned&&!l.showAbandonedChapters.getValue())continue;if(e.isEarlyAccess&&!l.earlyAccess.getValue())continue;const n=this.addItem(e.displayName,{button:!0,link:(0,s.chapterHref)(e.htmlRelativePath),decoration:(0,d.getDecorationForChapterType)(e.type)});e.abandoned&&n.prepend("[已弃坑]"),!0===t.showIndex&&n.prepend(`${e.displayIndex.join(".")}. `),e.isEarlyAccess&&n.prepend("[编写中]"),null!==e.charsCount&&l.charCount.getValue()&&n.append(`[${(0,u.shortNumber)(e.charsCount)}]`)}}}n.ChapterListingMenu=ChapterListingMenu},{"../Menu":11,"../control/chapterControl":22,"../data/data":40,"../data/hrefs":42,"../data/settings":44,"../util/shortNumber":69,"./ChaptersMenu":51}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ChaptersMenu=n.getDecorationForChapterType=void 0;const i=e("../data/hrefs"),a=e("../Menu"),s=e("./AuthorsMenu"),l=e("./ChapterListingMenu"),c=e("./HistoryChaptersMenu"),u=e("./LatestChapterMenu");n.getDecorationForChapterType=function getDecorationForChapterType(e){switch(e){case"Markdown":return a.ItemDecoration.ICON_FILE;case"WTCD":return a.ItemDecoration.ICON_GAME}};class ChaptersMenu extends a.Menu{constructor(e){super(e),this.buildSubMenu("所有书目",l.ChapterListingMenu).setDecoration(a.ItemDecoration.ICON_LIST).build(),this.buildSubMenu("最新更新",u.LatestChaptersMenu).setDecoration(a.ItemDecoration.ICON_CALENDER).build(),this.buildSubMenu("阅读历史",c.HistoryChaptersMenu).setDecoration(a.ItemDecoration.ICON_HISTORY).build(),this.addItem("按标签检索",{button:!0,link:(0,i.pageHref)("tag-search"),decoration:a.ItemDecoration.ICON_TAG}),this.buildSubMenu("按作者检索",s.AuthorsMenu).setDecoration(a.ItemDecoration.ICON_PERSON).build()}}n.ChaptersMenu=ChaptersMenu},{"../Menu":11,"../data/hrefs":42,"./AuthorsMenu":49,"./ChapterListingMenu":50,"./HistoryChaptersMenu":52,"./LatestChapterMenu":53}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HistoryChaptersMenu=void 0;const i=e("../data/data"),a=e("../data/hrefs"),s=e("../data/readingProgress"),l=e("../Menu"),c=e("./ChaptersMenu");class HistoryChaptersMenu extends l.Menu{constructor(e){super(e),(0,s.getHistory)().then((e=>{let t=!1;e.forEach((({relativePath:e,progress:n})=>{const s=i.relativePathLookUpMap.get(e);if(void 0===s)return;t=!0;this.addItem(s.folder.displayName+" > "+s.chapter.displayName,{button:!0,decoration:(0,c.getDecorationForChapterType)(s.chapter.type),link:(0,a.chapterHref)(s.chapter.htmlRelativePath)}).prepend(`[${1===n?"完成":`${Math.round(100*n)}%`}]`)})),t||this.addItem("阅读历史为空")}),(()=>{this.addItem("记录阅读历史需要浏览器支持 IndexedDB。您的浏览器不支持 IndexedDB。请更新浏览器后再试。")}))}}n.HistoryChaptersMenu=HistoryChaptersMenu},{"../Menu":11,"../data/data":40,"../data/hrefs":42,"../data/readingProgress":43,"./ChaptersMenu":51}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LatestChaptersMenu=void 0;const i=e("../data/data"),a=e("../data/hrefs"),s=e("../Menu"),l=e("../util/formatTime"),c=e("./ChaptersMenu");class LatestChaptersMenu extends s.Menu{constructor(e){super(e);let t=Array.from(i.relativePathLookUpMap.values());t=t.filter((e=>!e.chapter.htmlRelativePath.includes("META"))),t.sort(((e,t)=>t.chapter.creationTime-e.chapter.creationTime)),t=t.slice(0,20),t.forEach((e=>{this.addItem(e.folder.displayName+" > "+e.chapter.displayName,{button:!0,decoration:(0,c.getDecorationForChapterType)(e.chapter.type),link:(0,a.chapterHref)(e.chapter.htmlRelativePath)}).prepend(`[${(0,l.formatTimeRelativeLong)(new Date(1e3*e.chapter.creationTime))}]`)})),this.addItem("查看所有书目",{button:!0,decoration:s.ItemDecoration.ICON_LIST,link:"#/menu/书目选择/所有书目"})}}n.LatestChaptersMenu=LatestChaptersMenu},{"../Menu":11,"../data/data":40,"../data/hrefs":42,"../util/formatTime":66,"./ChaptersMenu":51}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MainMenu=void 0;const i=e("../Menu"),a=e("./ChaptersMenu"),s=e("./SettingsMenu"),l=e("./StyleMenu"),c=e("./ThanksMenu");class MainMenu extends i.Menu{constructor(e){super(e),this.container.classList.add("main"),this.buildSubMenu("书目选择",a.ChaptersMenu).build(),this.buildSubMenu("鸣谢列表",c.ThanksMenu).build(),this.buildSubMenu("阅读器样式",l.StyleMenu).build(),this.addItem("源代码",{button:!0,link:"https://github.com/CrystalTechStudio/Library"}),this.buildSubMenu("设置",s.SettingsMenu).build()}}n.MainMenu=MainMenu},{"../Menu":11,"./ChaptersMenu":51,"./SettingsMenu":55,"./StyleMenu":56,"./ThanksMenu":57}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SettingsMenu=n.EnumSettingMenu=void 0;const i=e("../constant/stylePreviewArticle"),a=e("../control/contentControl"),s=e("../control/layoutControl"),l=e("../control/processElements"),c=e("../data/settings"),u=e("../Menu");class EnumSettingMenu extends u.Menu{constructor(e,t,n,c){let d;if(super(e,n?s.Layout.SIDE:s.Layout.OFF),n){const e=(0,a.newContent)(a.Side.RIGHT).addBlock();e.element.innerHTML=i.stylePreviewArticle,(0,l.processElements)(e.element)}t.options.forEach(((e,n)=>{const i=this.addItem(e,{button:!0,decoration:u.ItemDecoration.SELECTABLE}).onClick((()=>{d.setSelected(!1),i.setSelected(!0),t.setValue(n),d=i,c()}));n===t.getValue()&&(d=i,i.setSelected(!0))}))}}n.EnumSettingMenu=EnumSettingMenu;class SettingsMenu extends u.Menu{constructor(e){super(e),this.addBooleanSetting("使用动画",c.animation),this.addBooleanSetting("显示编写中章节",c.earlyAccess),this.addBooleanSetting("显示评论",c.useComments),this.addBooleanSetting("手势切换章节（仅限手机）",c.gestureSwitchChapter),this.addEnumSetting("字体",c.fontFamily,!0),this.addBooleanSetting("开发人员模式",c.developerMode),this.addBooleanSetting("显示已弃坑章节",c.showAbandonedChapters),this.addBooleanSetting("禁用精简版自动跳转到完整版",c.lite)}addBooleanSetting(e,t){const getText=t=>`${e}：${t?"开":"关"}`,n=this.addItem(getText(t.getValue()),{button:!0}).onClick((()=>{t.toggle()}));t.event.on((e=>{n.setInnerText(getText(e))}))}addEnumSetting(e,t,n){const getText=()=>`${e}：${t.getValueName()}`,i=this.buildSubMenu(e,EnumSettingMenu,t,!0===n,(()=>{i.setInnerText(getText())})).setDisplayName(getText()).build()}}n.SettingsMenu=SettingsMenu},{"../Menu":11,"../constant/stylePreviewArticle":17,"../control/contentControl":24,"../control/layoutControl":27,"../control/processElements":35,"../data/settings":44}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StyleMenu=void 0;const i=e("../constant/stylePreviewArticle"),a=e("../control/contentControl"),s=e("../control/layoutControl"),l=e("../control/processElements"),c=e("../DebugLogger"),u=e("../hs"),d=e("../Menu");class Style{constructor(e,t){this.name=e,this.def=t,this.styleSheet=null,this.debugLogger=new c.DebugLogger(`Style (${e})`)}injectStyleSheet(){const e=document.createElement("style");document.head.appendChild(e);const t=e.sheet;t.disabled=!0;const attemptInsertRule=e=>{try{t.insertRule(e)}catch(t){this.debugLogger.error(`Failed to inject rule "${e}".`,t)}},n=`rgb(${this.def.keyColor.join(",")})`,keyAlpha=e=>`rgba(${this.def.keyColor.join(",")},${e})`;attemptInsertRule(`.menu .button:active::after { background-color: ${n}; }`),attemptInsertRule(`.button::after { background-color: ${n}; }`),attemptInsertRule(`body { background-color: ${this.def.paperBgColor}; }`),attemptInsertRule(`:root { --comment-color:${this.def.commentColor}; }`),attemptInsertRule(`:root { --content-block-warning-color:${this.def.contentBlockWarningColor}; }`),attemptInsertRule(`:root { --rect-bg-color: ${this.def.rectBgColor}; }`),attemptInsertRule(`:root { --paper-bg-color: ${this.def.paperBgColor}; }`),attemptInsertRule(`:root { --link-color: ${this.def.linkColor}; }`),attemptInsertRule(`:root { --link-hover-color: ${this.def.linkHoverColor}; }`),attemptInsertRule(`:root { --link-active-color: ${this.def.linkActiveColor}; }`),attemptInsertRule(`:root { --key: ${n}; }`),attemptInsertRule(`:root { --key-opacity-01: ${keyAlpha(.1)}; }`),attemptInsertRule(`:root { --key-opacity-014: ${keyAlpha(.14)}; }`),attemptInsertRule(`:root { --key-opacity-015: ${keyAlpha(.15)}; }`),attemptInsertRule(`:root { --key-opacity-023: ${keyAlpha(.23)}; }`),attemptInsertRule(`:root { --key-opacity-05: ${keyAlpha(.5)}; }`),attemptInsertRule(`:root { --key-opacity-07: ${keyAlpha(.7)}; }`),attemptInsertRule(`:root { --key-opacity-007: ${keyAlpha(.07)}; }`),attemptInsertRule(`:root { --key-opacity-004: ${keyAlpha(.04)}; }`),attemptInsertRule(`:root { --button-color: ${this.def.commentColor}; }`),this.styleSheet=t}activate(){if(null!==Style.currentlyEnabled){const e=Style.currentlyEnabled;null!==e.styleSheet&&(e.styleSheet.disabled=!0)}null===this.styleSheet&&this.injectStyleSheet(),this.styleSheet.disabled=!1,window.localStorage.setItem("style",this.name),null===Style.themeColorMetaTag?(Style.themeColorMetaTag=(0,u.h)("meta",{name:"theme-color",content:this.def.paperBgColor}),document.head.appendChild(Style.themeColorMetaTag)):Style.themeColorMetaTag.content=this.def.paperBgColor,Style.currentlyEnabled=this}}Style.currentlyEnabled=null,Style.themeColorMetaTag=null;const E={linkColor:"#00E",linkHoverColor:"#F00",linkActiveColor:"#00E"},_={linkColor:"#7AB2E2",linkHoverColor:"#5A92C2",linkActiveColor:"#5A92C2"},p=[new Style("默认",Object.assign(Object.assign({rectBgColor:"#444",paperBgColor:"#333",keyColor:[221,221,221]},_),{contentBlockWarningColor:"#E65100",commentColor:"#444",keyIsDark:!1})),new Style("白纸",Object.assign(Object.assign({rectBgColor:"#EFEFED",paperBgColor:"#FFF",keyColor:[0,0,0]},E),{contentBlockWarningColor:"#FFE082",commentColor:"#F5F5F5",keyIsDark:!0})),new Style("夜间",Object.assign(Object.assign({rectBgColor:"#272B36",paperBgColor:"#38404D",keyColor:[221,221,221]},_),{contentBlockWarningColor:"#E65100",commentColor:"#272B36",keyIsDark:!1})),new Style("羊皮纸",Object.assign(Object.assign({rectBgColor:"#D8D4C9",paperBgColor:"#F8F4E9",keyColor:[85,40,48]},E),{contentBlockWarningColor:"#FFE082",commentColor:"#F9EFD7",keyIsDark:!0})),new Style("巧克力",Object.assign(Object.assign({rectBgColor:"#2E1C11",paperBgColor:"#3A2519",keyColor:[221,175,153]},_),{contentBlockWarningColor:"#E65100",commentColor:"#2C1C11",keyIsDark:!1}))];class StyleMenu extends d.Menu{constructor(e){super(e,s.Layout.SIDE);const t=p.map((e=>{const n=this.addItem(e.name,{button:!0,decoration:d.ItemDecoration.SELECTABLE}).onClick((()=>{e.activate(),t.forEach((e=>e.setSelected(!1))),n.setSelected(!0)}));return window.localStorage.getItem("style")===e.name&&n.setSelected(!0),n})),n=(0,a.newContent)(a.Side.RIGHT).addBlock().element;n.innerHTML=i.stylePreviewArticle,(0,l.processElements)(n)}}n.StyleMenu=StyleMenu;const m=window.localStorage.getItem("style");let f=!1;for(const e of p)if(m===e.name){e.activate(),f=!0;break}f||p[0].activate()},{"../DebugLogger":9,"../Menu":11,"../constant/stylePreviewArticle":17,"../control/contentControl":24,"../control/layoutControl":27,"../control/processElements":35,"../hs":45}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ThanksMenu=void 0;const i=e("../constant/thanks"),a=e("../Menu");class ThanksMenu extends a.Menu{constructor(e){super(e);for(const e of i.thanks)this.addItem(e.name,void 0===e.link?{}:{button:!0,link:e.link,decoration:a.ItemDecoration.ICON_LINK})}}n.ThanksMenu=ThanksMenu},{"../Menu":11,"../constant/thanks":18}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.author=void 0;const i=e("../constant/messages"),a=e("../constant/rolePriorities"),s=e("../control/navbarControl"),l=e("../data/data"),c=e("../data/hrefs"),u=e("../hs"),d=e("../util/formatRelativePath"),E=e("../util/padName");n.author={name:"author",handler:(e,t)=>{const n=t.get();(0,s.setNavbarPath)([{display:"作者列表",hash:"#/menu/书目选择/按作者检索"},{display:n,hash:null}]);const _=l.authorInfoMap.get(n),p=e.addBlock();p.element.appendChild((0,u.h)("h1",n)),void 0!==(null==_?void 0:_.description)&&p.element.appendChild((0,u.h)("p",_.description));const m=new Map;for(const[e,{chapter:{authors:t}}]of l.relativePathLookUpMap.entries())for(const{name:i,role:a}of t)i===n&&(m.has(a)?m.get(a).push(e):m.set(a,[e]));p.element.appendChild((0,u.h)("h2",i.AUTHOR_PAGE_WORKS)),p.element.appendChild((0,u.h)("p",i.AUTHOR_PAGE_WORKS_DESC.replace("$",(0,E.padName)(n))));const f=Array.from(m);f.sort((([e,t],[n,i])=>(0,a.getRolePriority)(n)-(0,a.getRolePriority)(e)));for(const[e,t]of f){p.element.appendChild((0,u.h)("h4",i.AUTHOR_PAGE_AS+e));const n=(0,u.h)("ul");for(const e of t)n.appendChild((0,u.h)("li",(0,d.formatRelativePath)(e),"（",(0,u.h)("a.regular",{href:(0,c.chapterHref)(e)},i.AUTHOR_PAGE_LINK),"）"));p.element.appendChild(n)}return p.element.appendChild((0,u.h)("div.page-switcher",[(0,u.h)("a.to-menu",{href:window.location.pathname,onclick:e=>{e.preventDefault(),history.back()}},i.GO_TO_MENU)])),!0}}},{"../constant/messages":13,"../constant/rolePriorities":16,"../control/navbarControl":31,"../data/data":40,"../data/hrefs":42,"../hs":45,"../util/formatRelativePath":65,"../util/padName":68}],59:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.tagSearch=void 0;const a=e("../$e"),s=e("../control/contentControl"),l=e("../control/modalControl"),c=e("../control/navbarControl"),u=e("../control/searchControl"),d=e("../data/data"),E=e("../data/hrefs"),_=e("../util/DOM"),p=e("../util/formatRelativePath"),m=e("../util/tag");function resolveAlias(e){let t="";"+-".includes(e[0])&&(t=e[0],e=e.substr(1));const n=e.split("（");return d.tagAliasMap.has(n[0].toLowerCase())&&(n[0]=d.tagAliasMap.get(n[0].toLowerCase())),t+n.join("（")}n.tagSearch={name:"tag-search",handler:(e,t)=>{(0,c.setNavbarPath)([{display:"标签搜索",hash:null}]),e.appendLeftSideContainer();const n=(0,a.$e)("textarea",{className:"general small"});n.value=t.get().split("/").join("\n");const f=(0,_.autoExpandTextArea)(n,40);let C=null;const g=e.addBlock({initElement:(0,a.$e)("div",null,(0,a.$e)("p",null,"请输入要搜索的标签："),n,(0,a.$e)("div",{className:"button-container",style:{marginTop:"0.6em"}},(0,a.$e)("div",{onclick:function openTagsList(){const e=new l.Modal((0,a.$e)("div",{style:{width:"1000px"}},(0,a.$e)("h1",null,"标签列表"),(0,a.$e)("p",null,"不是所有标签都有对应的文章。"),(0,a.$e)("p",null,d.data.tags.map((([e])=>{let t=n.value.trim().split(/\s+/).includes(e);const i=(0,m.tagSpan)(e,t);return i.addEventListener("click",(()=>{t?n.value=n.value.replace(new RegExp(`(^|\\s+)${e}(?=$|\\s)`,"g"),""):n.value+=`\n${e}`,n.value=n.value.trim(),updateSearch(n.value),f(),t=!t,i.classList.toggle("active",t)})),i}))),(0,a.$e)("div",{className:"button-container"},(0,a.$e)("div",{onclick:()=>e.close()},"关闭"))));e.setDismissible(),e.open()}},"选择标签"))),side:s.ContentBlockSide.LEFT}),T=e.addBlock({initElement:(0,a.$e)("div",null,(0,a.$e)("h1",null,"标签搜索"),(0,a.$e)("p",null,"请在搜索输入框中输入需要查找的标签以开始搜索。"),(0,a.$e)("p",null,"多个标签之间请用空格或换行分开。"),(0,a.$e)("p",null,"在一个标签前添加减号可以排除这个标签。"),(0,a.$e)("p",null,"在一个标签前添加加号可以强制需要这个标签。"),(0,a.$e)("p",null,"你也可以点击搜索输入框下方的",(0,a.$e)("b",null,"选择标签"),"来快速选择。"))}).hide(),N=e.addBlock({initElement:(0,a.$e)("div",null,(0,a.$e)("h1",null,"抱歉，未找到任何匹配的文章"),(0,a.$e)("p",null,"本标签搜索系统只能搜索文章标签，不能搜索文章标题或内容。请检查你所使用的搜索标签是否为正确的文章标签。你可以点击搜索输入框下方的",(0,a.$e)("b",null,"选择标签"),"来列出所有可用的标签。"),(0,a.$e)("p",null,"同时，因为标签系统刚刚实装，绝大多数文章还没有标签。所有没有标签的文章将无法被搜索到。如果你发现你喜欢的文章还没有标签，你可以选择帮助打标签。"))}).hide(),I=[];let M=0;function updateSearch(s){return i(this,void 0,void 0,(function*(){M++;const i=M,l=(s=s.trim()).split(/\s+/).map(resolveAlias).filter((e=>""!==e));t.set(l.join("/"));const c=l.map((e=>e.startsWith("+")?{searchTag:e.substr(1),type:"required"}:e.startsWith("-")?{searchTag:e.substr(1),type:"excluded"}:{searchTag:e,type:"favored"})),_=yield(0,u.search)(c);if(i!==M)return;const O=[];for(const{searchTag:e}of c){const t=e.match(/^[+-]?(\S+?)(?:（(\S+?)）)?$/),n=d.data.tags.find((([e])=>e===t[1]));void 0===n?O.push((0,a.$e)("li",null,"标签“",t[1],"”不存在。")):void 0!==t[2]&&(null===n[1]?O.push((0,a.$e)("li",null,"标签“",t[1],"”不支持性别变种。")):n[1].includes(t[2])||O.push((0,a.$e)("li",null,"标签“",t[1],"”没有性别变种“",t[2],"”。")))}null==C||C.remove(),0!==O.length&&(C=(0,a.$e)("ul",null,...O),g.element.append(C)),I.forEach((e=>e.directRemove())),I.length=0,N.hide(),T.hide(),0===_.length?""===s?T.show():N.show():function showResultsFrom(t){var i;const s=Math.min(_.length-1,t+9);for(let l=t;l<=s;l++){const{chapter:t,score:u,matchedTags:d}=_[l],C=e.addBlock({initElement:(0,a.$e)("div",{className:"tag-search-chapter"},1!==c.length&&(0,a.$e)("p",{className:"match-ratio"},"匹配率：",(0,a.$e)("span",{style:{fontWeight:u===c.length?"bold":"normal"}},(u/c.length*100).toFixed(0),"%")),(0,a.$e)("h3",{className:"chapter-title"},(0,a.$e)("a",{href:(0,E.chapterHref)(t.htmlRelativePath)},(0,p.formatRelativePath)(t.htmlRelativePath))),(0,a.$e)("p",null,t.authors.map((e=>e.role+"："+e.name)).join("，")),null===(i=t.tags)||void 0===i?void 0:i.map((e=>{const t=d.includes(e),i=(0,m.tagSpan)(e,t);return i.addEventListener("click",(()=>{if(t){let t=n.value.replace(new RegExp(`(^|\\s+)\\+?${e}(?=$|\\s)`,"g"),"");e.includes("（")&&(t=t.replace(new RegExp(`(^|\\s+)\\+?${e.split("（")[0]}(?=$|\\s)`,"g"),"")),t=t.trim(),n.value=t}else n.value+=`\n${e}`;updateSearch(n.value),f()})),i})))});l===s&&s<_.length-1&&C.onEnteringView((()=>showResultsFrom(l+1))),I.push(C)}}(0)}))}return updateSearch(n.value),n.addEventListener("input",(()=>updateSearch(n.value))),!0}}},{"../$e":8,"../control/contentControl":24,"../control/modalControl":30,"../control/navbarControl":31,"../control/searchControl":37,"../data/data":40,"../data/hrefs":42,"../util/DOM":62,"../util/formatRelativePath":65,"../util/tag":72}],60:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.taggingTool=void 0;const a=e("../$e"),s=e("../control/modalControl"),l=e("../control/navbarControl"),c=e("../data/db"),u=e("../DebugLogger"),d=e("../hs"),E=e("../util/DOM"),_=new u.DebugLogger("Tagging Tool"),p=(0,c.dbKVKey)("taggingToolSelected"),m=(0,c.dbKVKey)("taggingToolShowingVariants");function createTagVariant(e,t){return`${e}（${t}）`}n.taggingTool={name:"tagging-tool",handler:e=>{(0,l.setNavbarPath)([{display:"标签工具",hash:null}]);const t=e.addBlock({initElement:(0,d.h)("div","正在加载标签规格...")});return i(void 0,void 0,void 0,(function*(){var n,l;const u=JSON.parse(yield fetch("./tagsSpec.json").then((e=>e.text()))),f=new Set(null!==(n=yield(0,c.dbKVGet)(m))&&void 0!==n?n:["女"]);t.directRemove();const C=new Map,g=new Map;let T=0;for(const e of u)C.set(e.tag,e),g.set(e.tag,T),T++;const N=new Set,I=e.addBlock({initElement:(0,d.h)(".tagging-tool")}),M=new Map,O=new Set;u.forEach((e=>{var t;return null===(t=e.variants)||void 0===t?void 0:t.forEach((e=>O.add(e)))}));const S=new Map(Array.from(O).map((e=>[e,[]]))),R=new Array,L=[],v=(0,d.h)("code");function setSelected(e,t){const n=M.get(e);if(void 0===n)return _.warn("Unknown tag variant:",e),!1;for(const{checkbox:e,span:i}of n)e.checked=t,i.classList.toggle("selected",t);t?N.add(e):N.delete(e);for(const e of R)e.classList.remove("errored");for(const e of M.values())for(const{span:t}of e)t.classList.remove("errored");let i=!1;for(const{sourceTagVariant:e,requiresTagVariants:t,span:n,li:a}of L)N.has(e)&&!t.some((e=>N.has(e)))&&(i=!0,a.classList.add("errored"),n.classList.add("errored"));return i?v.innerText="有未满足的前置标签，输出已终止。缺失的前置标签已用红色标出。":0===N.size?v.innerText="请至少选择一个标签。":v.innerText=Array.from(N).sort(((e,t)=>{const n=e.split("（")[0],i=t.split("（")[0],a=C.get(i).priority-C.get(n).priority;return 0!==a?a:g.get(n)-g.get(i)})).join("，"),(0,c.dbKVSet)(p,Array.from(N)).catch((e=>_.error(e))),!0}function setHovered(e,t){const n=M.get(e);for(const{span:e}of n)e.classList.toggle("hovered",t)}function createTagVariantElements(e,t,n){const i=void 0===n?t:createTagVariant(t,n),a=(0,d.h)("input",{type:"checkbox"});let s=M.get(i);void 0===s&&(s=[],M.set(i,s));const l=(0,d.h)("span.tagging-tool-tag-variant",[a,e]);return void 0!==n&&S.get(n).push({tag:t,tagVariantSpan:l}),s.push({checkbox:a,span:l}),l.addEventListener("click",(()=>{N.has(i)?setSelected(i,!1):setSelected(i,!0)})),l.addEventListener("mouseenter",(()=>{setHovered(i,!0)})),l.addEventListener("mouseleave",(()=>{setHovered(i,!1)})),l}function createTagElement(e,t){if(null===e.variants){const n=createTagVariantElements(e.tag,e.tag);if(void 0!==t){const i=t.sourceTagSpec;if(null===i.variants)L.push({sourceTagVariant:i.tag,requiresTagVariants:[e.tag],li:t.li,span:n});else for(const a of i.variants)L.push({sourceTagVariant:createTagVariant(i.tag,a),requiresTagVariants:[e.tag],li:t.li,span:n})}return n}{const n=[];for(const i of e.variants){const a=createTagVariantElements(i,e.tag,i);if(void 0!==t){const n=t.sourceTagSpec;null!==n.variants?L.push({sourceTagVariant:createTagVariant(n.tag,i),requiresTagVariants:[createTagVariant(e.tag,i)],li:t.li,span:a}):L.push({sourceTagVariant:n.tag,requiresTagVariants:e.variants.map((t=>createTagVariant(e.tag,t))),li:t.li,span:a})}n.push(a)}return(0,d.h)("span.tagging-tool-tag",[e.tag,(0,d.h)("span.no-available-variants","无可用变种"),...n])}}I.element.append((0,a.$e)("h1",null,"标签工具"));const A=[];for(const e of O){let t=f.has(e);const n=(0,d.h)("input",{type:"checkbox"}),i=(0,d.h)("span.tagging-tool-variant",[n,e]),update=()=>{t?f.add(e):f.delete(e),(0,c.dbKVSet)(m,Array.from(f)),n.checked=t,i.classList.toggle("selected",t),S.get(e).forEach((({tagVariantSpan:e})=>{e.classList.toggle("display-none",!t),e.parentElement.classList.toggle("has-available-variant",Array.from(e.parentElement.getElementsByClassName("tagging-tool-tag-variant")).some((e=>!e.classList.contains("display-none"))))}))};A.push(update),i.addEventListener("click",(()=>{t=!t,update()})),I.element.append(i)}function requestResettingTags(){(0,s.confirm)("真的要重置所有选择的标签吗？","这个操作不可撤销。","确定重置","不重置").then((e=>{if(e)for(const e of N)setSelected(e,!1)}))}I.element.append((0,d.h)("h2","选择标签")),I.element.append((0,a.$e)("div",{className:"button-container"},(0,a.$e)("div",{onclick:requestResettingTags},"重置所有选择的标签"),(0,a.$e)("div",{onclick:function requestImportTags(){const e=(0,a.$e)("textarea",{className:"general large"});function execute(n){return i(this,void 0,void 0,(function*(){const i=e.value.trim();if(""===i)return void(0,s.showGenericError)("请输入要导入的标签。");if(n){if(!(yield(0,s.confirm)("确定导入","这将重置目前已经选择的所有标签。你真的要继续吗？","确定导入","取消导入")))return;for(const e of N)setSelected(e,!1)}const l=[];for(const e of i.split(/[\s，,]+/))setSelected(e,!0)||l.push(e);if(0===l.length)yield(0,s.showGenericSuccess)("导入成功"),t.close();else{const e=new s.Modal((0,a.$e)("div",null,(0,a.$e)("h1",null,"部分标签未能导入"),(0,a.$e)("p",null,"以下为导入失败的标签："),(0,a.$e)("ul",null,l.map((e=>(0,a.$e)("li",null,e)))),(0,a.$e)("p",null,"其余标签已导入完成。"),(0,a.$e)("div",{className:"button-container"},(0,a.$e)("div",{onclick:()=>e.close()},"关闭"))));e.setDismissible(),e.open()}}))}const t=new s.Modal((0,a.$e)("div",null,(0,a.$e)("h1",null,"导入标签"),(0,a.$e)("p",null,"请输入要导入的标签，不同标签之间请用空格或逗号分开："),e,(0,a.$e)("div",{className:"button-container",style:{marginTop:"0.6em"}},(0,a.$e)("div",{onclick:()=>execute(!0)},"替换当前标签"),(0,a.$e)("div",{onclick:()=>execute(!1)},"追加到当前标签"),(0,a.$e)("div",{onclick:()=>t.close()},"取消导入"))));t.setDismissible(),t.open(),(0,E.autoExpandTextArea)(e)}},"导入标签"))),I.element.append((0,a.$e)("p",null,"请选择文章所含有的标签："));for(const e of u){I.element.append((0,d.h)("p.tag-title",createTagElement(e)));const t=(0,d.h)("ul");for(const n of e.desc){const i=(0,d.h)("li.desc-line");n.isPrerequisite&&R.push(i);for(const t of n.segments)"text"===t.type?i.append(t.content):n.isPrerequisite?i.append(createTagElement(C.get(t.tag),{li:i,sourceTagSpec:e})):i.append(createTagElement(C.get(t.tag)));t.append(i)}I.element.append(t)}I.element.append((0,d.h)("h2","输出")),I.element.append((0,d.h)("p","以下为选择的标签。")),I.element.append((0,d.h)("pre.wrapping",v)),I.element.append((0,a.$e)("p",null,"如果想要为其他文章打标签，请",(0,a.$e)("span",{className:"anchor-style",onclick:requestResettingTags},"点此重置已经选择了的标签"),"。")),A.forEach((e=>e())),(null!==(l=yield(0,c.dbKVGet)(p))&&void 0!==l?l:[]).forEach((e=>setSelected(e,!0)))})).catch((e=>_.error(e))),!0}}},{"../$e":8,"../DebugLogger":9,"../control/modalControl":30,"../control/navbarControl":31,"../data/db":41,"../hs":45,"../util/DOM":62}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.visitCount=void 0;const i=e("../constant/messages"),a=e("../control/backendControl"),s=e("../control/menuControl"),l=e("../control/navbarControl"),c=e("../data/AutoCache"),u=e("../data/data"),d=e("../data/hrefs"),E=e("../DebugLogger"),_=e("../hs"),p=e("../util/commaNumber"),m=e("../util/formatRelativePath"),f=e("../util/padName"),C=e("../util/shortNumber"),g=["ALL","HOUR","DAY","WEEK","MONTH","YEAR"];const T=new E.DebugLogger("Visit Count Logger");function getTimeFrameText(e){switch(e){case"ALL":return i.VISIT_COUNT_TIME_FRAME_ALL;case"HOUR":return i.VISIT_COUNT_TIME_FRAME_HOUR;case"DAY":return i.VISIT_COUNT_TIME_FRAME_DAY;case"WEEK":return i.VISIT_COUNT_TIME_FRAME_WEEK;case"YEAR":return i.VISIT_COUNT_TIME_FRAME_YEAR;case"MONTH":return i.VISIT_COUNT_TIME_FRAME_MONTH}}const N=new c.AutoCache((e=>fetch(e).then((e=>e.json()))),new E.DebugLogger("Visit Count Cache"));n.visitCount={name:"visit-count",handler:e=>{(0,l.setNavbarPath)([{display:i.VISIT_COUNT_TITLE,hash:null}]);const t=e.addBlock();t.element.appendChild((0,_.h)("h1",i.VISIT_COUNT_TITLE)),t.element.appendChild((0,_.h)("p",[i.VISIT_COUNT_DESC_0,(0,_.h)("a.regular",{href:"#META/隐私政策.html"},i.VISIT_COUNT_DESC_1),i.VISIT_COUNT_DESC_2]));const n=(0,_.h)("p"),c=(0,_.h)(".visit-count-holder"),E=(0,_.h)("div.rich"),I=(0,_.h)(".button-container.display-none",{style:{"margin-top":"0.5em"}},E);let M=0,O="ALL",S=2,R=0;const load=(t,s)=>{const l=function getEndpoint(e,t){return"ALL"===e?`${a.backendUrl}/stats/chapters/all?page=${t}`:`${a.backendUrl}/stats/chapters/recent?page=${t}&time_frame=${e}`}(t,s);M++;const g=M;T.log(`Request ID ${g}: Loading visit count info from ${l}.`),N.get(l).then((a=>{var l,N;if(e.isDestroyed||g!==M)T.log(`Request ID ${g}: Request completed, but the result is abandoned.`);else{1===s?(R=null!==(N=null===(l=a[0])||void 0===l?void 0:l.visit_count)&&void 0!==N?N:0,I.classList.remove("display-none")):E.classList.remove("disabled"),n.innerText=i.VISIT_COUNT_DISPLAYING.replace(/\$/g,(0,f.padName)(getTimeFrameText(t))),E.innerText=i.VISIT_COUNT_LOAD_MORE,I.classList.toggle("display-none",50!==a.length);for(const e of a)u.relativePathLookUpMap.has(e.relative_path)&&c.appendChild((0,_.h)("a",{style:{width:e.visit_count/R*100+"%"},title:(0,p.commaNumber)(e.visit_count)+i.VISIT_COUNT_TIMES,href:(0,d.chapterHref)(e.relative_path)},(O=e.relative_path,L=e.visit_count,(0,m.formatRelativePath)(O)+": "+(0,C.shortNumber)(L,2)+i.VISIT_COUNT_TIMES)));var O,L;S=s+1}})).catch((t=>{e.isDestroyed||g!==M?T.warn(`Request ID ${g}: Request failed, but the result is abandoned.`,t):1===s?n.innerText=i.VISIT_COUNT_FAILED:(E.classList.remove("disabled"),E.innerText=i.VISIT_COUNT_LOAD_MORE_FAILED)}))};E.addEventListener("click",(()=>{E.classList.contains("disabled")||(E.classList.add("disabled"),E.innerText=i.VISIT_COUNT_LOAD_MORE_LOADING,load(O,S))}));const loadTimeFrame=e=>{c.innerHTML="",n.innerText=i.VISIT_COUNT_LOADING,I.classList.add("display-none"),O=e,S=2,load(e,1)},L=[];return t.element.appendChild((0,_.h)(".button-container",g.map((e=>((e,t)=>{const n=(0,_.h)("div.rich",{onclick:()=>{for(const e of L)e.classList.toggle("selected",e===n);loadTimeFrame(t)}},e);return"ALL"===t&&n.classList.add("selected"),L.push(n),n})(getTimeFrameText(e),e))))),t.element.appendChild(n),t.element.appendChild(c),t.element.appendChild(I),t.element.appendChild((0,_.h)("div.page-switcher",[(0,_.h)("a",{href:window.location.pathname,onclick:e=>{e.preventDefault(),(0,s.enterMenuMode)()}},i.GO_TO_MENU)])),loadTimeFrame("ALL"),!0}}},{"../DebugLogger":9,"../constant/messages":13,"../control/backendControl":21,"../control/menuControl":28,"../control/navbarControl":31,"../data/AutoCache":39,"../data/data":40,"../data/hrefs":42,"../hs":45,"../util/commaNumber":64,"../util/formatRelativePath":65,"../util/padName":68,"../util/shortNumber":69}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.autoExpandTextArea=n.forceReflow=n.linkButton=n.externalLink=n.insertAfterH1=n.insertAfter=n.isAnyParent=n.selectNode=n.getTextNodes=n.id=void 0;const i=e("../DebugLogger"),a=e("../hs");n.id=function id(e){return document.getElementById(e)},n.getTextNodes=function getTextNodes(e,t){const n=t||[];let i=e.firstChild;for(;null!==i;)i instanceof HTMLElement&&getTextNodes(i,n),i instanceof Text&&n.push(i),i=i.nextSibling;return n};const s=new i.DebugLogger("Select Node");function insertAfter(e,t){t.parentElement.insertBefore(e,t.nextSibling)}n.selectNode=function selectNode(e){try{const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}catch(t){s.log("Failed to select node: ",e,"; Error: ",t)}},n.isAnyParent=function isAnyParent(e,t){for(;null!==e;){if(t(e))return!0;e=e.parentElement}return!1},n.insertAfter=insertAfter,n.insertAfterH1=function insertAfterH1(e,t){const n=t.firstChild;null!==n&&n instanceof HTMLHeadingElement&&"h1"===n.tagName.toLowerCase()?insertAfter(e,n):t.prepend(e)},n.externalLink=function externalLink(e,t){return(0,a.h)("a.regular",{target:"_blank",href:t,rel:"noopener noreferrer"},e)},n.linkButton=function linkButton(e,t){return(0,a.h)("a.regular",{href:"#",onclick:e=>{e.preventDefault(),t()}},e)},n.forceReflow=function forceReflow(e){e.offsetHeight},n.autoExpandTextArea=function autoExpandTextArea(e,t=120){function update(){e.style.height="1px",e.style.height=`${Math.max(t,e.scrollHeight)}px`}return e.addEventListener("input",update,!1),setTimeout(update,1),update}},{"../DebugLogger":9,"../hs":45}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.produce=n.range=n.lastElement=void 0,n.lastElement=function lastElement(e){return e[e.length-1]},n.range=function range(e,t,n=1){const i=[];for(let a=e;a<t;a+=n)i.push(a);return i},n.produce=function produce(e,t){const n=[];for(let i=0;i<e;i++)n.push(t());return n}},{}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.commaNumber=void 0,n.commaNumber=function commaNumber(e){const t=[];for(;e>=1e3;)t.push(String(e%1e3).padStart(3,"0")),e=Math.floor(e/1e3);return t.push(String(e)),t.reverse(),t.join(",")}},{}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.formatRelativePath=void 0,n.formatRelativePath=function formatRelativePath(e){return e.endsWith(".html")&&(e=e.substr(0,e.length-".html".length)),e=(e=e.replace(/\//g," > ")).replace(/-/g," ")}},{}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.formatTimeSimple=n.formatDurationCoarse=n.formatTimeRelativeLong=n.formatTimeRelative=void 0;const i=6e4,a=36e5,s=24*a,l=2628e6,c=365*s,u=7*s;function formatTimeRelative(e){const t=Date.now()-e.getTime();return t>u?`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`:t>s?`${Math.floor(t/s)} 天前`:t>a?`${Math.floor(t/a)} 小时前`:t>i?`${Math.floor(t/i)} 分钟前`:`${Math.floor(t/1e3)} 秒前`}n.formatTimeRelative=formatTimeRelative,n.formatTimeRelativeLong=function formatTimeRelativeLong(e){const t=Date.now()-e.getTime();return t<=u?formatTimeRelative(e):t>c?`${Math.floor(t/c)} 年前`:t>l?`${Math.floor(t/l)} 个月前`:`${Math.floor(t/s)} 天前`},n.formatDurationCoarse=function formatDurationCoarse(e){if(e>10*s)return` ${Math.floor(e/s)} 天`;if(e>a){const t=Math.floor(e/s),n=Math.floor(e%s/a);return 0===n?` ${t} 天`:` ${t} 天 ${n} 小时`}return"不到一小时"},n.formatTimeSimple=function formatTimeSimple(e){return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`}},{}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.randomNumber=n.randomInt=void 0,n.randomInt=function randomInt(e,t){return Math.floor(Math.random()*(t-e))+e},n.randomNumber=function randomNumber(e,t){return Math.random()*(t-e)+e}},{}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.padName=void 0;const i=/^(?:[\u4E00-\u9FCC\u3400-\u4DB5\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\ud840-\ud868][\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|[\ud86a-\ud86c][\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d])/,a=/(?:[\u4E00-\u9FCC\u3400-\u4DB5\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\ud840-\ud868][\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|[\ud86a-\ud86c][\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d])$/;n.padName=function padName(e){return i.test(e)||(e=" "+e),a.test(e)||(e+=" "),e}},{}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shortNumber=void 0,n.shortNumber=function shortNumber(e,t=1){return e<1e3?String(e):e<1e6?(e/1e3).toFixed(t)+"k":(e/1e6).toFixed(t)+"M"}},{}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.removePotentialSuffix=void 0,n.removePotentialSuffix=function removePotentialSuffix(e,t){return e.endsWith(t)?e.substr(0,e.length-t.length):e}},{}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.stringHash=void 0,n.stringHash=function stringHash(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}},{}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tagSpan=void 0;const i=e("../$e"),a=e("../data/data");n.tagSpan=function tagSpan(e,t){var n;const s=null!==(n=a.tagCountMap.get(e))&&void 0!==n?n:0;return(0,i.$e)("div",{className:"tag-div"+(t?" active":"")},(0,i.$e)("span",{className:"tag"+(0===s?" empty":"")},(0,i.$e)("span",{className:"text"+(e.endsWith("）")?" parentheses-ending":"")},e),(0,i.$e)("span",{className:"count"},s)))}},{"../$e":8,"../data/data":40}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.smartThrottle=void 0,n.smartThrottle=function smartThrottle(e,t){let n=!1,i=!1;return()=>{if(n)i=!0;else{e();const timedOut=()=>{i?(e(),i=!1,setTimeout(timedOut,t)):n=!1};n=!0,setTimeout(timedOut,t)}}}},{}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetUrlArgumentsTo=void 0,n.resetUrlArgumentsTo=function resetUrlArgumentsTo(e){window.history.replaceState(null,document.title,window.location.origin+"/"+window.location.hash.split("~")[0]+(0===e.size?"":"~"+Array.from(e).map((([e,t])=>""===t?e:`${e}=${t}`))))}},{}]},{},[46]);